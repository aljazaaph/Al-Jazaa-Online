<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Al-Jazaa Ph</title>
    
    <link rel="icon" type="image/png" href="https://github.com/ianianguro-art/Website-Gallery-Image/blob/main/Jaz%20Logo%20gold.png?raw=true">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#1b4d3e', 'primary-dark': '#143a2f', gold: '#c5a028', 'bg-soft': '#f8fafc' },
                    fontFamily: { sans: ['Outfit', 'sans-serif'], serif: ['Playfair Display', 'serif'] }
                }
            }
        }
    </script>

    <style>
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass-nav { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .accordion-content { transition: max-height 0.3s ease-out; max-height: 0; overflow: hidden; }
        .accordion-content.active { max-height: 500px; }
        .rotate-180 { transform: rotate(180deg); }
        .loader-spin { border: 4px solid #f3f3f3; border-top: 4px solid #c5a028; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .view-section { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .modal-enter { animation: modalPop 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes modalPop { 0% { opacity: 0; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1); } }
        .sticky-bottom-action { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #eee; padding: 12px 16px; z-index: 50; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="bg-bg-soft text-gray-800 antialiased pt-[70px] pb-[80px]">

    <script>const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzQ3ij0tm5k-cARhUqdRdV7yYmqfudy0LJnaK70DVAMyTcjO-vcc5WvwFQ36lRxobcF/exec";</script>

    <div id="loader" class="fixed inset-0 bg-white z-[9999] flex flex-col justify-center items-center">
        <div class="loader-spin mb-4"></div><h3 class="font-serif text-2xl text-primary font-bold">Al-Jazaa</h3>
    </div>

    <!-- NAVBAR -->
    <nav class="fixed top-0 w-full z-40 glass-nav h-[70px] flex items-center shadow-sm">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a href="#" onclick="routeTo('home')" class="flex items-center gap-2 text-primary font-serif font-bold text-xl md:text-2xl">
                <img src="https://github.com/ianianguro-art/Website-Gallery-Image/blob/main/Jaz%20Logo%20gold.png?raw=true" alt="Logo" class="h-10 w-auto"> Al-Jazaa Ph.
            </a>
            <div class="flex items-center gap-5">
                <div class="relative cursor-pointer" onclick="routeTo('cart')">
                    <i class="fas fa-shopping-bag text-2xl text-primary hover:text-gold transition"></i>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-gold text-white text-[10px] font-bold h-5 w-5 flex items-center justify-center rounded-full shadow-md">0</span>
                </div>
                <button onclick="toggleMobileMenu()" class="text-primary text-2xl focus:outline-none"><i class="fas fa-bars"></i></button>
            </div>
        </div>
    </nav>

    <!-- MENU DASHBOARD -->
    <div id="mobile-menu" class="fixed inset-y-0 right-0 w-72 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50 flex flex-col">
        <div class="bg-primary p-5 flex justify-between items-center text-white">
            <h5 class="font-serif font-bold text-lg">Menu</h5>
            <button onclick="toggleMobileMenu()"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div class="p-4 flex-1 overflow-y-auto">
            <div class="flex flex-col gap-2 mb-6">
                <a href="#" onclick="routeTo('home'); toggleMobileMenu()" class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 text-gray-700 font-medium"><i class="fas fa-home text-primary w-6"></i> Shop Home</a>
                <a href="#" onclick="event.preventDefault(); openModal('track'); toggleMobileMenu()" class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 text-gray-700 font-medium"><i class="fas fa-search-location text-primary w-6"></i> Track Order</a>
                <a href="#" onclick="event.preventDefault(); openModal('reviews'); toggleMobileMenu()" class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 text-gray-700 font-medium"><i class="fas fa-star text-primary w-6"></i> Reviews</a>
            </div>
            <hr class="border-gray-100 mb-6">
            <h6 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3">Categories</h6>
            <div id="sidebar-cats-list" class="flex flex-col gap-1"></div>
        </div>
    </div>
    <div id="menu-overlay" onclick="toggleMobileMenu()" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

    <!-- MAIN CONTENT -->
    <main id="main-content" class="min-h-screen">
        
        <!-- HOME PAGE -->
        <div id="page-home" class="view-section">
            <div class="container mx-auto px-4 mt-6 mb-8">
                <div class="relative"><input type="text" id="searchBox" class="w-full pl-5 pr-12 py-3 rounded-full border border-gray-200 shadow-sm focus:outline-none focus:ring-1 focus:ring-primary bg-white" placeholder="Search products..." onkeyup="doSearch()"><i class="fas fa-search absolute right-5 top-1/2 transform -translate-y-1/2 text-gray-400"></i></div>
            </div>

            <!-- Categories -->
            <section class="container mx-auto px-4 mb-10">
                <h2 class="font-serif text-2xl font-bold text-primary mb-4">Shop Categories</h2>
                <div id="category-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-6"></div>
            </section>

            <!-- Suggested -->
            <section class="mb-12 bg-white py-8 border-y border-gray-100 shadow-sm">
                <div class="container mx-auto px-4">
                    <h2 class="font-serif text-xl font-bold text-primary mb-1">Suggested For You</h2>
                    <p class="text-xs text-gray-500 mb-4">Top picks based on trends</p>
                    <div id="suggested-container" class="flex overflow-x-auto gap-4 pb-4 hide-scrollbar snap-x snap-mandatory"></div>
                </div>
            </section>

            <!-- Banners -->
            <section class="container mx-auto px-4 mb-12">
                <h2 class="font-serif text-xl font-bold text-primary mb-4">Promotions</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="rounded-2xl overflow-hidden shadow-lg h-48 group relative"><img src="https://github.com/ianianguro-art/Menu-POS/blob/main/Header%201.png?raw=true" class="w-full h-full object-cover transition duration-500 group-hover:scale-105"><div class="absolute inset-0 bg-black/10"></div></div>
                    <div class="rounded-2xl overflow-hidden shadow-lg h-48 group relative"><img src="https://github.com/ianianguro-art/Menu-POS/blob/main/big-sale-woolpack-1.jpg?raw=true" class="w-full h-full object-cover transition duration-500 group-hover:scale-105"><div class="absolute inset-0 bg-black/10"></div></div>
                    <div class="rounded-2xl overflow-hidden shadow-lg h-48 group relative"><img src="https://github.com/ianianguro-art/Menu-POS/blob/main/Header%203.png?raw=true" class="w-full h-full object-cover transition duration-500 group-hover:scale-105"><div class="absolute inset-0 bg-black/10"></div></div>
                </div>
            </section>

            <!-- Reviews Slider -->
            <section class="container mx-auto px-4 mb-12">
                <div class="flex justify-between items-end mb-4">
                    <h2 class="font-serif text-xl font-bold text-primary">Customer Love</h2>
                    <button onclick="openModal('reviews')" class="text-xs font-bold text-gold hover:text-primary transition uppercase tracking-wider">View All</button>
                </div>
                <div id="home-reviews-slider" class="flex overflow-x-auto gap-4 pb-6 hide-scrollbar snap-x mb-8"></div>
            </section>

            <!-- Policies -->
            <section class="container mx-auto px-4 mb-16 max-w-2xl">
                <h2 class="font-serif text-xl font-bold text-primary mb-4">Information</h2>
                <div class="space-y-3">
                    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden"><button class="w-full flex justify-between items-center p-4 font-bold text-gray-700 bg-white" onclick="toggleAccordion(this)"><span>About Al-Jazaa</span><i class="fas fa-chevron-down accordion-icon text-gray-400 transition-transform duration-300"></i></button><div class="accordion-content px-4 bg-gray-50 text-sm text-gray-600"><p class="py-4 border-t border-gray-100">Al-Jazaa Ph. is committed to providing timeless modesty with Islamic integrity.</p></div></div>
                    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden"><button class="w-full flex justify-between items-center p-4 font-bold text-gray-700 bg-white" onclick="toggleAccordion(this)"><span>Payment Policy</span><i class="fas fa-chevron-down accordion-icon text-gray-400 transition-transform duration-300"></i></button><div class="accordion-content px-4 bg-gray-50 text-sm text-gray-600"><p class="py-4 border-t border-gray-100">We strictly accept GCash payments. Verification required.</p></div></div>
                    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden"><button class="w-full flex justify-between items-center p-4 font-bold text-gray-700 bg-white" onclick="toggleAccordion(this)"><span>Return & Delivery</span><i class="fas fa-chevron-down accordion-icon text-gray-400 transition-transform duration-300"></i></button><div class="accordion-content px-4 bg-gray-50 text-sm text-gray-600"><p class="py-4 border-t border-gray-100">Returns accepted within 3 days for defects. Nationwide delivery via J&T.</p></div></div>
                </div>
            </section>
        </div>

        <!-- GRID PAGE -->
        <div id="page-grid" class="view-section hidden container mx-auto px-4 py-8">
            <h2 id="grid-title" class="font-serif text-2xl font-bold text-primary mb-6">Products</h2>
            <div id="full-product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
        </div>

        <!-- DETAIL PAGE -->
        <div id="page-detail" class="view-section hidden pb-[90px] md:pb-12 bg-white min-h-screen">
            <div class="md:hidden h-[60px] flex items-center px-4 border-b bg-white shadow-sm shrink-0 sticky top-0 z-40">
                <button onclick="window.history.back()" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100"><i class="fas fa-arrow-left text-xl text-gray-700"></i></button>
                <span class="ml-4 font-bold text-lg text-primary truncate">Product Details</span>
            </div>
            <div class="hidden md:block container mx-auto px-4 py-6"><button onclick="window.history.back()" class="flex items-center text-gray-500 hover:text-primary transition"><i class="fas fa-arrow-left mr-2"></i> Back to Shop</button></div>
            <div class="container mx-auto px-0 md:px-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-0 md:gap-12">
                    <div class="relative w-full bg-gray-50 md:rounded-3xl overflow-hidden aspect-[3/4] md:aspect-[4/5] md:sticky md:top-24">
                        <img id="dt-img" class="w-full h-full object-contain md:object-cover">
                        <span id="dt-badge" class="absolute top-4 left-4 bg-primary text-white text-xs font-bold px-3 py-1 rounded hidden">SALE</span>
                        <div id="dt-gallery" class="absolute bottom-4 left-0 w-full flex justify-center gap-2 px-4 overflow-x-auto hide-scrollbar"></div>
                    </div>
                    <div class="p-5 md:p-0 md:pt-4">
                        <div id="dt-cat" class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 border border-gray-200 inline-block px-2 py-1 rounded">Category</div>
                        <h1 id="dt-name" class="font-serif text-3xl md:text-4xl font-bold text-gray-900 mb-4 leading-tight"></h1>
                        <div class="mb-6 flex items-center gap-3"><span id="dt-price-display" class="text-2xl md:text-3xl font-bold text-green-700"></span><span id="dt-old-price" class="text-lg text-gray-400 line-through hidden"></span></div>
                        <p id="dt-desc" class="text-gray-600 text-sm leading-relaxed mb-8 border-b border-gray-100 pb-6"></p>
                        <div class="space-y-6 mb-8">
                            <div><label class="block text-xs font-bold text-gray-800 mb-2 uppercase tracking-wide">Size <span class="text-red-500">*</span></label><div id="size-opts" class="flex flex-wrap gap-3"></div></div>
                            <div><label class="block text-xs font-bold text-gray-800 mb-2 uppercase tracking-wide">Color <span class="text-red-500">*</span></label><div id="color-opts" class="flex flex-wrap gap-3"></div></div>
                            <div><label class="block text-xs font-bold text-gray-800 mb-2 uppercase tracking-wide">Height <span class="text-red-500">*</span></label><input type="text" id="dt-height" class="w-full md:w-1/2 p-3 bg-white border border-gray-300 rounded focus:border-primary outline-none text-sm transition" placeholder="e.g. 5'4" oninput="checkAddBtn()"></div>
                            <div class="pt-4 flex flex-col md:flex-row gap-4 items-start md:items-end">
                                <div class="w-full md:w-auto"><label class="block text-xs font-bold text-gray-800 mb-2 uppercase tracking-wide">Quantity</label><div class="flex items-center border border-gray-300 rounded h-12 w-full md:w-40 bg-white"><button onclick="changeQty(-1)" class="w-12 h-full text-gray-600 hover:bg-gray-50 font-bold">-</button><input type="text" id="dt-qty" value="1" readonly class="flex-1 text-center font-bold text-gray-800 outline-none h-full"><button onclick="changeQty(1)" class="w-12 h-full text-gray-600 hover:bg-gray-50 font-bold">+</button></div></div>
                                <button id="btn-add-desktop" onclick="addToCart()" disabled class="hidden md:block flex-1 bg-primary hover:bg-primary-dark disabled:bg-gray-300 disabled:cursor-not-allowed text-white h-12 px-8 rounded font-bold uppercase tracking-wide shadow-lg transition w-full">Add to Cart</button>
                            </div>
                        </div>
                        <div id="bundle-area" class="mb-10 hidden bg-gray-50 p-4 rounded-xl border border-gray-100">
                            <label class="block text-xs font-bold text-primary mb-3 uppercase">Bundle Offers</label>
                            <div class="space-y-3">
                                <div class="bundle-opt bg-white border rounded p-3 flex justify-between items-center cursor-pointer hover:border-primary transition" onclick="selectBundle(1, this)"><span class="text-sm font-medium">1 Piece</span><span class="text-xs text-gray-500">Standard</span></div>
                                <div class="bundle-opt bg-white border rounded p-3 flex justify-between items-center cursor-pointer hover:border-primary transition" onclick="selectBundle(2, this)"><div><span class="text-sm font-medium">2 Pieces</span> <span class="bg-primary text-white text-[10px] px-2 py-0.5 rounded-full ml-2">5% OFF</span></div><span class="font-bold text-primary text-sm" id="bp-2"></span></div>
                                <div class="bundle-opt bg-white border rounded p-3 flex justify-between items-center cursor-pointer hover:border-primary transition" onclick="selectBundle(3, this)"><div><span class="text-sm font-medium">3 Pieces</span> <span class="bg-primary text-white text-[10px] px-2 py-0.5 rounded-full ml-2">10% OFF</span></div><span class="font-bold text-primary text-sm" id="bp-3"></span></div>
                            </div>
                        </div>
                        <div class="pt-8 border-t border-gray-200"><h3 class="font-serif text-xl font-bold text-gray-800 mb-4">You might also like</h3><div id="related-products-area" class="flex gap-4 overflow-x-auto hide-scrollbar pb-2"></div></div>
                    </div>
                </div>
            </div>
            <div class="md:hidden sticky-bottom-action">
                <div class="flex flex-col"><span class="text-[10px] text-gray-500 uppercase tracking-wide">Total Price</span><span id="sticky-price" class="font-serif text-xl font-bold text-primary">₱0</span></div>
                <button id="btn-add" onclick="addToCart()" disabled class="bg-primary hover:bg-primary-dark disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-8 h-11 rounded font-bold text-sm uppercase tracking-wide shadow-lg transition">Add to Bag</button>
            </div>
        </div>

        <!-- CART PAGE -->
        <div id="page-cart" class="view-section hidden container mx-auto px-4 py-8 pb-32">
            <h2 class="font-serif text-2xl font-bold text-center mb-6">Shopping Bag</h2>
            <div id="cart-content" class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-6"></div>
            <div id="cart-summary" class="hidden bg-white p-5 rounded-xl border shadow-sm sticky bottom-[90px]">
                <div class="flex justify-between items-center mb-4"><span class="text-gray-500">Subtotal</span><span id="cart-total" class="font-bold text-xl text-primary">₱0</span></div>
                <button onclick="routeTo('checkout')" class="w-full bg-gold text-white py-3 rounded-lg font-bold uppercase tracking-wide shadow-md hover:bg-yellow-600 transition">Checkout</button>
            </div>
        </div>

        <!-- CHECKOUT PAGE -->
        <div id="page-checkout" class="view-section hidden container mx-auto px-4 py-8 pb-32 max-w-2xl">
            <div class="bg-white rounded-xl shadow-lg p-5 border border-gray-100">
                <h2 class="font-serif text-2xl font-bold text-primary text-center mb-1">Checkout</h2>
                <p class="text-center text-xs text-gray-500 mb-6">Complete your details to place order</p>
                <form id="checkout-form" onsubmit="submitOrder(event)" oninput="validateCheckoutForm()">
                    <div class="bg-green-50 p-4 rounded-lg border border-green-100 mb-6 text-center">
                        <div class="font-bold text-primary text-sm mb-1">✨ Donate to Orphans (Sadaqah) ✨</div>
                        <p class="text-xs text-gray-600 mb-3">Add a small percentage to help those in need.</p>
                        <div class="flex flex-wrap justify-center gap-2 mb-2">
                            <button type="button" class="donate-pill border border-primary text-primary px-3 py-1 text-xs rounded hover:bg-primary hover:text-white transition" onclick="selectDonation(0.05, this)">5%</button>
                            <button type="button" class="donate-pill border border-primary text-primary px-3 py-1 text-xs rounded hover:bg-primary hover:text-white transition" onclick="selectDonation(0.10, this)">10%</button>
                            <button type="button" class="donate-pill border border-primary text-primary px-3 py-1 text-xs rounded hover:bg-primary hover:text-white transition" onclick="selectDonation(0.20, this)">20%</button>
                            <button type="button" class="donate-pill border border-primary text-primary px-3 py-1 text-xs rounded hover:bg-primary hover:text-white transition" onclick="selectDonation(0, this)">None</button>
                        </div>
                        <textarea id="donation-note" class="w-full p-2 text-xs border rounded bg-white mt-2 hidden" placeholder="Special Intention / Note"></textarea>
                    </div>
                    <h6 class="font-bold text-xs uppercase text-gray-400 mb-3">1. Delivery & Address</h6>
                    <div class="space-y-3 mb-6">
                        <select id="del-method" class="w-full p-3 bg-gray-50 border rounded-lg text-sm outline-none focus:border-primary" onchange="toggleDeliveryOptions()" required><option value="" disabled selected>Select Delivery Method</option><option value="Pick-up">Pick-up (Free)</option><option value="Delivery">Delivery (Courier)</option></select>
                        <input type="text" id="c-name" class="w-full p-3 bg-gray-50 border rounded-lg text-sm outline-none focus:border-primary" placeholder="Full Name" required>
                        <div class="grid grid-cols-2 gap-3"><input type="number" id="c-phone" class="w-full p-3 bg-gray-50 border rounded-lg text-sm outline-none focus:border-primary" placeholder="Phone No." required><input type="email" id="c-email" class="w-full p-3 bg-gray-50 border rounded-lg text-sm outline-none focus:border-primary" placeholder="Email" required></div>
                        <div id="delivery-fields" class="space-y-3 hidden border-t pt-3 mt-3">
                            <label class="text-xs font-bold text-primary">Shipping Address</label><input type="text" id="addr-street" class="w-full p-3 bg-gray-50 border rounded-lg text-sm" placeholder="House / Street / Subd.">
                            <div class="grid grid-cols-2 gap-3"><input type="text" id="addr-brgy" class="w-full p-3 bg-gray-50 border rounded-lg text-sm" placeholder="Barangay"><input type="text" id="addr-city" class="w-full p-3 bg-gray-50 border rounded-lg text-sm" placeholder="City"></div>
                            <div class="grid grid-cols-2 gap-3"><input type="text" id="addr-prov" class="w-full p-3 bg-gray-50 border rounded-lg text-sm" placeholder="Province"><select id="addr-region" class="w-full p-3 bg-gray-50 border rounded-lg text-sm" onchange="calcShipping()"><option value="" disabled selected>Region</option><option value="Metro Manila">Metro Manila</option><option value="Luzon">Luzon</option><option value="Visayas">Visayas</option><option value="Mindanao">Mindanao</option><option value="Island">Island</option></select></div>
                            <input type="text" id="addr-zip" class="w-full p-3 bg-gray-50 border rounded-lg text-sm" placeholder="Zip Code">
                        </div>
                    </div>
                    <h6 class="font-bold text-xs uppercase text-gray-400 mb-3">2. Payment</h6>
                    <div class="bg-gray-50 p-4 rounded-lg border mb-4">
                        <div class="flex items-center gap-3 mb-3"><div class="bg-blue-500 text-white font-bold p-2 rounded text-xs">GCash</div><div class="text-sm"><div class="font-bold">Send to: 0976-551-3716</div></div></div>
                        <input type="text" id="c-ref" class="w-full p-3 bg-white border rounded-lg text-sm mb-3" placeholder="GCash Reference No." required>
                        <label class="block w-full border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:bg-white transition"><span class="text-xs text-gray-500"><i class="fas fa-camera mr-1"></i> Upload Payment Screenshot</span><input type="file" id="c-proof" accept="image/*" class="hidden"></label><div id="upload-msg" class="text-center text-xs text-green-600 font-bold mt-2 hidden">Screenshot Attached!</div>
                    </div>
                    <div class="bg-white border-t border-b py-4 mb-6"><div class="flex justify-between text-sm mb-1"><span>Subtotal:</span> <span id="sum-subtotal">₱0</span></div><div class="flex justify-between text-sm mb-1"><span>Delivery Fee:</span> <span id="sum-shipping" class="text-red-500">₱0</span></div><div class="flex justify-between text-sm mb-1 hidden text-green-600 font-bold" id="sum-donate-row"><span>Donation:</span> <span id="sum-donation">₱0</span></div><div class="flex justify-between text-xl font-bold text-primary mt-2 border-t pt-2"><span>Grand Total:</span> <span id="pay-total">₱0</span></div></div>
                    <button type="submit" id="btn-place-order" class="w-full bg-gray-300 text-white py-4 rounded-lg font-bold text-lg uppercase tracking-wide transition" disabled>Fill Details</button>
                </form>
            </div>
        </div>
    </main>

    <!-- POPUP MODALS (TRACKING & REVIEWS) -->
    
    <!-- Track Order Modal -->
    <div id="modal-track" class="fixed inset-0 bg-black/80 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm" onclick="closeModal('track')">
        <div class="bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl relative transform transition-all" onclick="event.stopPropagation()">
            <button onclick="closeModal('track')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-700"><i class="fas fa-times text-xl"></i></button>
            <h3 class="font-serif text-2xl font-bold text-primary mb-4 text-center">Track Your Order</h3>
            <div class="flex shadow-sm rounded-full overflow-hidden border mb-6 bg-gray-50">
                <input type="text" id="track-id" class="w-full px-5 py-3 bg-transparent outline-none text-sm" placeholder="Enter Order ID (e.g. ALJ-12345)">
                <button onclick="trackOrder()" class="bg-primary text-white px-6 font-bold hover:bg-primary-dark transition text-sm">Search</button>
            </div>
            <div id="track-result" class="hidden bg-gray-50 p-4 rounded-xl border border-gray-100 text-left">
                <div id="t-status" class="text-lg font-bold text-primary mb-2"></div>
                <div class="flex justify-between text-sm text-gray-600"><span>Date:</span> <span id="t-date" class="font-bold"></span></div>
                <div class="flex justify-between text-sm text-gray-600 mt-1"><span>Total:</span> <span id="t-total" class="font-bold"></span></div>
            </div>
        </div>
    </div>

    <!-- Reviews Modal -->
    <div id="modal-reviews" class="fixed inset-0 bg-black/80 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm" onclick="closeModal('reviews')">
        <div class="bg-white w-full max-w-lg h-[80vh] rounded-2xl shadow-2xl relative flex flex-col transform transition-all" onclick="event.stopPropagation()">
            <div class="p-5 border-b flex justify-between items-center bg-gray-50 rounded-t-2xl">
                <h3 class="font-serif text-xl font-bold text-primary">Customer Reviews</h3>
                <button onclick="closeModal('reviews')" class="text-gray-400 hover:text-gray-700"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-5 space-y-4" id="main-reviews-list"></div>
            <div class="p-4 border-t bg-gray-50 rounded-b-2xl">
                <button onclick="document.getElementById('modal-review-form').classList.toggle('hidden')" class="w-full bg-primary text-white py-3 rounded-lg font-bold text-sm uppercase shadow hover:bg-primary-dark transition">Write a Review</button>
                <div id="modal-review-form" class="hidden mt-4 pt-4 border-t border-gray-200">
                    <form onsubmit="submitInstantReview(event, 'modal')">
                        <div class="flex gap-1 mb-3 text-2xl text-gray-300 flex-row-reverse justify-end"><input type="radio" name="m-rating" id="mr5" value="5" class="hidden peer/5"><label for="mr5" class="peer-checked/5:text-gold hover:text-gold cursor-pointer">★</label><input type="radio" name="m-rating" id="mr4" value="4" class="hidden peer/4"><label for="mr4" class="peer-checked/4:text-gold hover:text-gold peer-checked/5:text-gold cursor-pointer">★</label><input type="radio" name="m-rating" id="mr3" value="3" class="hidden peer/3"><label for="mr3" class="peer-checked/3:text-gold hover:text-gold peer-checked/4:text-gold peer-checked/5:text-gold cursor-pointer">★</label><input type="radio" name="m-rating" id="mr2" value="2" class="hidden peer/2"><label for="mr2" class="peer-checked/2:text-gold hover:text-gold peer-checked/3:text-gold peer-checked/4:text-gold peer-checked/5:text-gold cursor-pointer">★</label><input type="radio" name="m-rating" id="mr1" value="1" class="hidden peer/1"><label for="mr1" class="peer-checked/1:text-gold hover:text-gold peer-checked/2:text-gold peer-checked/3:text-gold peer-checked/4:text-gold peer-checked/5:text-gold cursor-pointer">★</label></div>
                        <input type="text" id="mr-name" class="w-full p-2 bg-white border rounded mb-2 text-sm" placeholder="Name" required><textarea id="mr-feedback" class="w-full p-2 bg-white border rounded mb-2 text-sm" rows="2" placeholder="Experience..." required></textarea>
                        <button type="submit" class="w-full bg-gray-800 text-white py-2 rounded text-xs font-bold uppercase">Post</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="bg-primary-dark text-gray-400 py-12 text-sm">
        <div class="container mx-auto px-4 grid md:grid-cols-3 gap-8">
            <div><h3 class="font-serif text-white text-xl mb-4">Al-Jazaa Ph.</h3><p class="mb-4">Modesty with Integrity.</p><div class="flex gap-4"><a href="#" class="text-white hover:text-gold"><i class="fab fa-facebook fa-lg"></i></a><a href="#" class="text-white hover:text-gold"><i class="fab fa-instagram fa-lg"></i></a><a href="#" class="text-white hover:text-gold"><i class="fab fa-whatsapp fa-lg"></i></a></div></div>
            <div><h4 class="text-white font-bold mb-4 uppercase tracking-wider">Contact</h4><p class="mb-2"><i class="fas fa-envelope mr-2"></i> aljazaa.ph@gmail.com</p><p><i class="fas fa-phone mr-2"></i> 0921-429-xxxx</p></div>
            <div><h4 class="text-white font-bold mb-4 uppercase tracking-wider">Links</h4><ul class="space-y-2"><li><a href="#" onclick="routeTo('home')" class="hover:text-gold cursor-pointer">Shop Home</a></li><li><a href="#" onclick="openModal('track')" class="hover:text-gold cursor-pointer">Track Order</a></li></ul></div>
        </div>
        <div class="text-center mt-12 pt-8 border-t border-gray-700">&copy; 2024 Al-Jazaa Ph. All Rights Reserved.</div>
    </footer>

    <!-- LOGIC -->
    <script>
        let allProducts=[], cart=JSON.parse(localStorage.getItem('alj_cart_v16'))||[], allReviews = [];
        let curProduct={}, selectedSize=null, selectedColor=null, bundleQty=1;
        let cartTotalAmount=0, currentDonationPercent=0, currentShippingFee=0;

        const catImages = {
            'All': 'https://cdn-icons-png.flaticon.com/512/3502/3502601.png', 
            'Jilbab': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat2.png?raw=true',
            'Khimar': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat4.png?raw=true',
            'Abaya': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat3.png?raw=true',
            'Set': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat5.png?raw=true',
            'Niqab': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat1.png?raw=true',
            'Default': 'https://cdn-icons-png.flaticon.com/512/4430/4430945.png'
        };

        document.addEventListener("DOMContentLoaded", () => {
            fetchProducts(); updateCartBadge();
            window.history.replaceState({ page: 'home' }, '', '');
            window.onpopstate = (e) => {
                if(e.state) renderPage(e.state.page); else renderPage('home');
            };
            document.getElementById('c-proof').addEventListener('change', function() {
                const msg = document.getElementById('upload-msg');
                if(this.files.length > 0) msg.classList.remove('hidden'); else msg.classList.add('hidden');
                validateCheckoutForm();
            });
        });

        function routeTo(pageId) { window.history.pushState({ page: pageId }, '', ''); renderPage(pageId); }

        function renderPage(pageId) {
            window.scrollTo(0,0);
            ['page-home', 'page-grid', 'page-detail', 'page-cart', 'page-checkout'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            closeModal('track'); closeModal('reviews');

            if (pageId === 'home') document.getElementById('page-home').classList.remove('hidden');
            else if (pageId === 'cart') { renderCart(); document.getElementById('page-cart').classList.remove('hidden'); }
            else if (pageId === 'checkout') { 
                if(cart.length === 0) { routeTo('home'); return; }
                initCheckout(); 
                document.getElementById('page-checkout').classList.remove('hidden'); 
            }
            else if (pageId === 'detail') document.getElementById('page-detail').classList.remove('hidden');
            else document.getElementById('page-' + pageId).classList.remove('hidden');
        }

        // --- MODAL LOGIC ---
        function openModal(type) {
            const modal = document.getElementById('modal-' + type);
            if(modal) {
                modal.classList.remove('hidden');
                modal.firstElementChild.classList.add('modal-enter');
                if(type === 'reviews') renderReviews(allReviews, 'main-reviews-list');
            }
        }

        function closeModal(type) {
            const modal = document.getElementById('modal-' + type);
            if(modal) modal.classList.add('hidden');
        }

        function toggleMobileMenu() {
            const m = document.getElementById('mobile-menu');
            const o = document.getElementById('menu-overlay');
            if (m.classList.contains('translate-x-full')) {
                m.classList.remove('translate-x-full');
                o.classList.remove('hidden');
            } else {
                m.classList.add('translate-x-full');
                o.classList.add('hidden');
            }
        }
        
        function toggleAccordion(btn) {
            btn.nextElementSibling.classList.toggle('active');
            btn.querySelector('i').classList.toggle('rotate-180');
        }

        // --- DATA ---
        function fetchProducts() {
            fetch(WEB_APP_URL + "?action=getProducts").then(r => r.json()).then(data => {
                allProducts = data;
                document.getElementById('loader').classList.add('hidden');
                renderCats(); renderSuggested();
                fetch(WEB_APP_URL + "?action=getReviews").then(r=>r.json()).then(revs => {
                    allReviews = revs;
                    renderReviews(allReviews.slice(0, 5), 'home-reviews-slider', true);
                });
            });
        }

        function renderCats() {
            const cats = ['All', ...new Set(allProducts.map(p => p.category))];
            document.getElementById('category-grid').innerHTML = cats.map(c => {
                let img = catImages[c] || catImages['Default'];
                return `<div onclick="filterCat('${c}')" class="flex flex-col gap-2 cursor-pointer group"><div class="relative w-full aspect-square rounded-xl overflow-hidden bg-gray-100 shadow-sm border border-gray-100 group-hover:border-gold transition"><img src="${img}" class="w-full h-full object-cover group-hover:scale-110 transition duration-500" onerror="this.src='${catImages['Default']}'"></div><div class="text-center"><span class="font-bold text-gray-800 text-sm uppercase tracking-wide group-hover:text-primary transition">${c}</span></div></div>`;
            }).join('');
            document.getElementById('sidebar-cats-list').innerHTML = cats.map(c => `<div onclick="filterCat('${c}'); toggleMobileMenu()" class="px-3 py-2 text-sm text-gray-600 hover:text-primary hover:bg-gray-50 rounded cursor-pointer transition flex items-center justify-between">${c} <i class="fas fa-chevron-right text-xs opacity-50"></i></div>`).join('');
        }

        function renderSuggested() {
            const items = allProducts.sort(() => 0.5 - Math.random()).slice(0, 6);
            document.getElementById('suggested-container').innerHTML = items.map(p => `
                <div onclick="openDetail('${p.id}')" class="snap-start shrink-0 w-40 bg-white rounded-lg shadow-sm border overflow-hidden cursor-pointer"><img src="${p.image}" class="w-full h-40 object-cover"><div class="p-2"><div class="flex text-gold text-[10px] mb-1">★★★★★</div><div class="text-xs font-bold text-gray-800 truncate">${p.name}</div><div class="text-primary font-bold text-sm">₱${p.price}</div></div></div>`).join('');
        }

        function filterCat(c) {
            const list = c === 'All' ? allProducts : allProducts.filter(p => p.category === c);
            document.getElementById('grid-title').innerText = c;
            document.getElementById('full-product-grid').innerHTML = list.map(p => `
                <div onclick="openDetail('${p.id}')" class="bg-white rounded-lg shadow-sm border overflow-hidden cursor-pointer"><div class="relative w-full pt-[133%] bg-gray-50"><img src="${p.image}" class="absolute top-0 left-0 w-full h-full object-cover">${p.salePercent > 0 ? `<span class="absolute top-2 left-2 bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded">SALE</span>` : ''}</div><div class="p-3"><div class="font-bold text-sm truncate mb-1">${p.name}</div><div class="flex items-center gap-2"><span class="text-primary font-bold">₱${p.price}</span>${p.salePercent > 0 ? `<span class="text-[10px] text-gray-400 line-through">₱${p.originalPrice}</span>` : ''}</div></div></div>`).join('');
            routeTo('grid');
        }

        // --- DETAIL VIEW ---
        function openDetail(id) {
            curProduct = allProducts.find(p => p.id == id);
            selectedSize = null; selectedColor = null; bundleQty = 1; document.getElementById('dt-height').value = '';
            
            document.getElementById('dt-img').src = curProduct.image;
            document.getElementById('dt-name').innerText = curProduct.name;
            document.getElementById('dt-cat').innerText = curProduct.category;
            document.getElementById('dt-desc').innerText = curProduct.desc;
            
            if(curProduct.salePercent > 0) {
                document.getElementById('dt-old-price').innerText = "₱" + curProduct.originalPrice;
                document.getElementById('dt-old-price').classList.remove('hidden');
                document.getElementById('dt-price-display').classList.add('text-red-600');
                document.getElementById('dt-badge').classList.remove('hidden');
            } else {
                document.getElementById('dt-old-price').classList.add('hidden');
                document.getElementById('dt-price-display').classList.remove('text-red-600');
                document.getElementById('dt-badge').classList.add('hidden');
            }
            document.getElementById('dt-price-display').innerText = "₱" + curProduct.price;

            let imgs = (curProduct.images && curProduct.images.length) ? curProduct.images : [curProduct.image];
            document.getElementById('dt-gallery').innerHTML = imgs.map(src => `<img src="${src}" class="w-16 h-16 rounded border object-cover cursor-pointer" onclick="document.getElementById('dt-img').src='${src}'">`).join('');

            const isNiqab = curProduct.category.toLowerCase() === 'niqab';
            if(isNiqab) {
                document.getElementById('size-opts').innerHTML = '<span class="text-sm text-gray-500">Free Size</span>';
                selectedSize = "Free Size"; document.getElementById('bundle-area').classList.add('hidden');
            } else {
                document.getElementById('size-opts').innerHTML = ['S','M','L','XL'].map(s => `<button class="opt-btn size border border-gray-300 text-gray-600 px-4 py-2 rounded hover:border-primary transition font-medium text-sm" onclick="pickOpt('size','${s}',this)">${s}</button>`).join('');
                document.getElementById('bundle-area').classList.remove('hidden');
                document.getElementById('bp-2').innerText = "₱" + Math.floor(curProduct.price * 2 * 0.95);
                document.getElementById('bp-3').innerText = "₱" + Math.floor(curProduct.price * 3 * 0.90);
                selectBundle(1, document.querySelector('.bundle-opt'));
            }

            let colors = curProduct.colors ? curProduct.colors.split(',') : ['Default'];
            document.getElementById('color-opts').innerHTML = colors.map(c => `<button class="opt-btn color border border-gray-300 text-gray-600 px-4 py-2 rounded hover:border-primary transition font-medium text-sm" onclick="pickOpt('color','${c.trim()}',this)">${c.trim()}</button>`).join('');

            renderRelated(curProduct.category, curProduct.id);
            updateStickyPrice(); checkAddBtn();
            routeTo('detail');
        }

        function renderRelated(cat, id) {
            const related = allProducts.filter(p => p.category === cat && p.id !== id).sort(()=>0.5-Math.random()).slice(0,5);
            document.getElementById('related-products-area').innerHTML = related.map(p => `
                <div onclick="openDetail('${p.id}')" class="shrink-0 w-32 cursor-pointer group"><div class="w-full h-40 rounded-lg mb-2 bg-gray-50 overflow-hidden"><img src="${p.image}" class="w-full h-full object-cover group-hover:scale-105 transition duration-300"></div><div class="text-xs font-bold truncate text-gray-800">${p.name}</div><div class="text-xs text-primary font-bold">₱${p.price}</div></div>`).join('');
        }

        function pickOpt(type, val, el) {
            const grp = type === 'size' ? '.opt-btn.size' : '.opt-btn.color';
            document.querySelectorAll(grp).forEach(b => {
                b.classList.remove('bg-primary', 'text-white', 'border-primary');
                b.classList.add('text-gray-600', 'border-gray-300');
            });
            el.classList.remove('text-gray-600', 'border-gray-300');
            el.classList.add('bg-primary', 'text-white', 'border-primary');
            if(type === 'size') selectedSize = val; else selectedColor = val; checkAddBtn();
        }

        function selectBundle(q, el) {
            bundleQty = q; document.querySelectorAll('.bundle-opt').forEach(b => b.classList.remove('border-primary', 'bg-green-50'));
            el.classList.add('border-primary', 'bg-green-50'); document.getElementById('dt-qty').value = q; updateStickyPrice();
        }

        function changeQty(n) {
            let v = parseInt(document.getElementById('dt-qty').value) + n; if(v < 1) v = 1;
            document.getElementById('dt-qty').value = v;
            if(curProduct.category.toLowerCase() !== 'niqab') {
                const opts = document.querySelectorAll('.bundle-opt');
                if(v===1) selectBundle(1, opts[0]); else if(v===2) selectBundle(2, opts[1]); else if(v===3) selectBundle(3, opts[2]); else { bundleQty = v; updateStickyPrice(); }
            } else { bundleQty = v; updateStickyPrice(); }
        }

        function updateStickyPrice() {
            let p = curProduct.price * bundleQty;
            if(curProduct.category.toLowerCase() !== 'niqab') { if(bundleQty === 2) p*=0.95; if(bundleQty === 3) p*=0.90; }
            document.getElementById('sticky-price').innerText = "₱" + Math.ceil(p);
        }

        function checkAddBtn() {
            const h = document.getElementById('dt-height').value; const btns = [document.getElementById('btn-add'), document.getElementById('btn-add-desktop')];
            const isValid = selectedSize && selectedColor && h;
            btns.forEach(btn => { if(isValid) btn.disabled = false; else btn.disabled = true; });
        }

        function addToCart() {
            let unitP = curProduct.price;
            if(curProduct.category.toLowerCase() !== 'niqab') { if(bundleQty===2) unitP=(curProduct.price*2*0.95)/2; if(bundleQty===3) unitP=(curProduct.price*3*0.90)/3; }
            cart.push({ ...curProduct, size: selectedSize, color: selectedColor, height: document.getElementById('dt-height').value, qty: bundleQty, price: Math.ceil(unitP) });
            localStorage.setItem('alj_cart_v16', JSON.stringify(cart)); updateCartBadge();
            Swal.fire({icon:'success', title:'Added to Bag', toast:true, position:'top-end', showConfirmButton:false, timer:1500});
            window.history.back();
        }

        function updateCartBadge() { document.getElementById('cart-count').innerText = cart.length; }

        function renderCart() {
            const c = document.getElementById('cart-content');
            if(cart.length === 0) { c.innerHTML = '<div class="p-10 text-center text-gray-500">Your bag is empty</div>'; document.getElementById('cart-summary').classList.add('hidden'); return; }
            document.getElementById('cart-summary').classList.remove('hidden');
            let t = 0;
            c.innerHTML = cart.map((i, idx) => {
                t += i.price * i.qty;
                return `<div class="flex gap-3 p-4 border-b last:border-0"><img src="${i.image}" class="w-20 h-20 object-cover rounded bg-gray-50"><div class="flex-1"><div class="flex justify-between"><h4 class="font-bold text-sm text-gray-800">${i.name}</h4><button onclick="remItem(${idx})" class="text-red-400"><i class="fas fa-trash"></i></button></div><div class="text-xs text-gray-500 mb-1">${i.size} | ${i.color}</div><div class="flex justify-between items-end"><span class="text-primary font-bold">₱${i.price}</span><span class="text-xs bg-gray-100 px-2 py-1 rounded">Qty: ${i.qty}</span></div></div></div>`;
            }).join('');
            document.getElementById('cart-total').innerText = "₱" + t.toLocaleString();
        }
        function remItem(i) { cart.splice(i,1); localStorage.setItem('alj_cart_v16', JSON.stringify(cart)); updateCartBadge(); renderCart(); }

        function initCheckout() {
            cartTotalAmount = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
            currentDonationPercent = 0; currentShippingFee = 0;
            document.getElementById('del-method').value = ""; document.getElementById('delivery-fields').classList.add('hidden');
            document.getElementById('c-proof').value = ""; document.getElementById('upload-msg').classList.add('hidden');
            document.querySelectorAll('.donate-pill').forEach(b => b.classList.remove('bg-primary', 'text-white'));
            updateCheckoutCalc();
        }

        function toggleDeliveryOptions() {
            const m = document.getElementById('del-method').value; const fields = document.getElementById('delivery-fields'); const inputs = fields.querySelectorAll('input, select');
            if (m === 'Delivery') { fields.classList.remove('hidden'); inputs.forEach(i => i.required = true); calcShipping(); } 
            else { fields.classList.add('hidden'); inputs.forEach(i => i.required = false); currentShippingFee = 0; }
            updateCheckoutCalc();
        }

        function calcShipping() {
            if (document.getElementById('del-method').value !== 'Delivery') return;
            const region = document.getElementById('addr-region').value; let fee = 0;
            if(region === 'Metro Manila') fee = 90; else if(region === 'Luzon') fee = 150; else if(region === 'Visayas') fee = 210; else if(region === 'Mindanao') fee = 220; else if(region === 'Island') fee = 250;
            if(cartTotalAmount >= 3000) fee = 0; currentShippingFee = fee; updateCheckoutCalc();
        }

        function selectDonation(p, el) {
            currentDonationPercent = p; document.querySelectorAll('.donate-pill').forEach(b => b.classList.remove('bg-primary', 'text-white')); el.classList.add('bg-primary', 'text-white');
            if(p > 0) document.getElementById('donation-note').classList.remove('hidden'); else document.getElementById('donation-note').classList.add('hidden');
            updateCheckoutCalc();
        }

        function updateCheckoutCalc() {
            const don = Math.ceil(cartTotalAmount * currentDonationPercent); const total = cartTotalAmount + currentShippingFee + don;
            document.getElementById('sum-subtotal').innerText = "₱" + cartTotalAmount.toLocaleString(); document.getElementById('sum-shipping').innerText = "₱" + currentShippingFee;
            if(don > 0) { document.getElementById('sum-donate-row').classList.remove('hidden'); document.getElementById('sum-donation').innerText = "₱" + don; } else document.getElementById('sum-donate-row').classList.add('hidden');
            document.getElementById('pay-total').innerText = "₱" + total.toLocaleString(); validateCheckoutForm();
        }

        function validateCheckoutForm() {
            const f = document.getElementById('checkout-form'); const hasFile = document.getElementById('c-proof').files.length > 0; const btn = document.getElementById('btn-place-order');
            if(f.checkValidity() && hasFile) { btn.disabled = false; btn.innerText = "Place Order"; btn.classList.remove('bg-gray-300'); btn.classList.add('bg-primary', 'shadow-lg'); } else { btn.disabled = true; btn.innerText = "Fill All Details"; btn.classList.add('bg-gray-300'); btn.classList.remove('bg-primary', 'shadow-lg'); }
        }

        function submitOrder(e) {
            e.preventDefault(); const file = document.getElementById('c-proof').files[0];
            Swal.fire({ title: 'Processing...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
            const reader = new FileReader();
            reader.onload = function(evt) {
                const don = Math.ceil(cartTotalAmount * currentDonationPercent); const totalVal = cartTotalAmount + currentShippingFee + don;
                let addr = "Pick-up"; if (document.getElementById('del-method').value === 'Delivery') { addr = `${document.getElementById('addr-street').value}, ${document.getElementById('addr-brgy').value}, ${document.getElementById('addr-city').value}, ${document.getElementById('addr-prov').value}`; }
                const payload = {
                    action: 'placeOrder', cust: { name: document.getElementById('c-name').value, phone: document.getElementById('c-phone').value, email: document.getElementById('c-email').value, addr: addr },
                    pay: { ref: document.getElementById('c-ref').value, image: evt.target.result, mime: file.type }, cart: cart, total: "₱" + totalVal.toLocaleString(),
                    donation: { percent: (currentDonationPercent * 100) + "%", amount: don, note: document.getElementById('donation-note').value }, delivery: { method: document.getElementById('del-method').value, region: document.getElementById('addr-region').value || "N/A", fee: currentShippingFee }
                };
                fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify(payload) }).then(r => r.json()).then(d => {
                    if(d.status === 'success') { cart = []; localStorage.setItem('alj_cart_v16', JSON.stringify(cart)); Swal.fire({ icon:'success', title: 'Placed!', text: `ID: ${d.orderId}` }).then(() => window.location.reload()); } else Swal.fire('Error', d.error, 'error');
                });
            }; reader.readAsDataURL(file);
        }

        function renderReviews(list, containerId, isSlider = false) {
            const container = document.getElementById(containerId);
            if(!list || list.length === 0) { container.innerHTML = '<div class="text-sm text-gray-500 italic">No reviews yet.</div>'; return; }
            const cardClass = isSlider ? "snap-start shrink-0 w-[280px] bg-white p-5 rounded-xl shadow-sm border border-gray-100" : "bg-white p-4 rounded-xl border shadow-sm";
            container.innerHTML = list.map(r => `
                <div class="${cardClass}">
                    <div class="flex justify-between items-start mb-2"><div><span class="font-bold text-sm block">${r.name}</span><span class="text-gold text-xs">${'★'.repeat(r.rating)}</span></div><span class="text-[10px] text-gray-400">${r.date || 'Just now'}</span></div>
                    <p class="text-sm text-gray-600 italic">"${r.feedback}"</p>
                    ${r.reply ? `<div class="mt-3 bg-gray-50 p-3 rounded-lg border-l-4 border-primary text-xs text-gray-600"><span class="font-bold text-primary block mb-1">Admin Response</span>${r.reply}</div>` : ''}
                </div>`).join('');
        }

        function submitInstantReview(e, loc) {
            e.preventDefault(); 
            const prefix = loc === 'home' ? 'h' : 'm'; 
            const name = document.getElementById(prefix + 'r-name').value; 
            const fb = document.getElementById(prefix + 'r-feedback').value;
            let rating = 0; document.querySelectorAll(`input[name="${prefix}-rating"]`).forEach(r => { if(r.checked) rating = parseInt(r.value); });
            if(rating === 0) { Swal.fire('Oops','Select rating','warning'); return; }
            const newReview = { name: name, feedback: fb, rating: rating, date: new Date().toLocaleDateString() };
            allReviews.unshift(newReview); renderReviews(allReviews.slice(0, 5), 'home-reviews-slider', true);
            if(loc==='modal') renderReviews(allReviews, 'main-reviews-list');
            document.getElementById(prefix + 'r-name').value = ""; document.getElementById(prefix + 'r-feedback').value = "";
            document.querySelectorAll(`input[name="${prefix}-rating"]`).forEach(r => r.checked = false);
            Swal.fire({icon:'success', title:'Posted!', toast:true, position:'top-end', showConfirmButton:false, timer:1500});
            if(loc==='modal') document.getElementById('modal-review-form').classList.add('hidden');
            fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify({ action: 'submitReview', name: name, email: 'N/A', phone: 'N/A', feedback: fb, rating: rating }) });
        }

        function doSearch() {
            const q = document.getElementById('searchBox').value.toLowerCase(); if(q.length < 2) return;
            const matches = allProducts.filter(p => p.name.toLowerCase().includes(q));
            document.getElementById('grid-title').innerText = `Search: "${q}"`;
            document.getElementById('full-product-grid').innerHTML = matches.map(p => `
                <div onclick="openDetail('${p.id}')" class="bg-white rounded-lg shadow-sm border overflow-hidden cursor-pointer"><img src="${p.image}" class="w-full h-40 object-cover"><div class="p-2 font-bold text-sm">${p.name}</div></div>`).join('');
            routeTo('grid');
        }

        function trackOrder() {
            const id = document.getElementById('track-id').value; if(!id) return; Swal.fire({didOpen:()=>Swal.showLoading()});
            fetch(`${WEB_APP_URL}?action=trackOrder&orderId=${id}`).then(r=>r.json()).then(d => {
                Swal.close(); 
                document.getElementById('track-result').classList.remove('hidden');
                document.getElementById('t-status').innerText = d.status === 'found' ? d.currStatus : "Order Not Found";
                document.getElementById('t-date').innerText = d.date || '-'; document.getElementById('t-total').innerText = d.total || '-';
            });
        }
    </script>
</body>
</html>
