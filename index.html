<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al-Jazaa Ph. | Online Shop</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root {
            --primary: #1b4d3e; 
            --primary-dark: #143a2f;
            --gold: #c5a028;
            --bg-color: #f8f9fa; 
            --text: #2c3e50;
            --nav-height: 70px;
        }

        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text); 
            overflow-x: hidden; 
        }
        
        h1, h2, h3, h4, h5, .navbar-brand { font-family: 'Playfair Display', serif; }

        /* Announcement Bar */
        .announcement-bar { 
            background: var(--primary); color: white; text-align: center; 
            font-size: 0.75rem; padding: 8px 0; font-weight: 500; letter-spacing: 1px; text-transform: uppercase; 
            position: relative; z-index: 1040;
        }

        /* Navbar */
        .navbar { 
            background: rgba(255,255,255,0.98); backdrop-filter: blur(10px); 
            box-shadow: 0 2px 15px rgba(0,0,0,0.04); height: var(--nav-height);
            z-index: 1030;
        }
        .navbar-brand { font-weight: 700; font-size: 1.5rem; color: var(--primary) !important; }
        
        /* Sidebar */
        .offcanvas { border-radius: 0 20px 20px 0; border: none; }
        .offcanvas-header { background: var(--primary); color: white; }
        .offcanvas-title { font-family: 'Playfair Display'; letter-spacing: 1px; }
        .btn-close-white { filter: invert(1) grayscale(100%) brightness(200%); }
        .sidebar-link { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; color: var(--text); text-decoration: none; font-weight: 500; border-bottom: 1px solid #f0f0f0; transition: 0.2s; }
        .sidebar-link:hover { background: #f8f9fa; color: var(--primary); padding-left: 20px; }
        .policy-box { background: #fdfdfd; border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-top: 20px; max-height: 200px; overflow-y: auto; font-size: 0.85rem; color: #666; }
        .policy-box h6 { color: var(--primary); font-weight: 700; margin-top: 10px; }

        /* Hero Button */
        .btn-hero { background-color: var(--primary); color: var(--gold); border: 2px solid var(--gold); padding: 12px 40px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; border-radius: 50px; transition: all 0.3s ease; font-family: 'Playfair Display', serif; }
        .btn-hero:hover { background-color: var(--gold); color: var(--primary); box-shadow: 0 0 20px rgba(197, 160, 40, 0.5); transform: translateY(-2px); }

        /* Cart Badge */
        .cart-btn-wrap { position: relative; display: inline-flex; align-items: center; text-decoration: none; margin-right: 15px; cursor: pointer;}
        .cart-badge { background: var(--gold); color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: bold; position: absolute; top: -5px; right: -8px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

        /* Category Scroll with Images */
        .category-scroll-container { overflow-x: auto; white-space: nowrap; position: sticky; top: var(--nav-height); z-index: 900; background: rgba(248,249,250,0.95); backdrop-filter: blur(8px); padding: 15px 0; border-bottom: 1px solid rgba(0,0,0,0.05); -ms-overflow-style: none; scrollbar-width: none; }
        .category-scroll-container::-webkit-scrollbar { display: none; }
        
        .cat-item-wrapper { display: inline-flex; flex-direction: column; align-items: center; margin-right: 20px; cursor: pointer; transition: 0.2s; }
        .cat-item-wrapper:hover .cat-circle-img { transform: scale(1.1); border-color: var(--primary); }
        .cat-item-wrapper.active .cat-circle-img { border-color: var(--primary); transform: scale(1.05); box-shadow: 0 0 0 3px rgba(27, 77, 62, 0.2); }
        .cat-item-wrapper.active .cat-title { color: var(--primary); font-weight: 700; }

        .cat-circle-img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd; margin-bottom: 8px; transition: 0.3s; background: white; }
        .cat-title { font-size: 0.8rem; color: #666; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }

        /* Product Card & Gallery */
        .product-card { border: none; background: white; transition: 0.3s; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.03); height: 100%; position: relative; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
        .card-img-wrapper { position: relative; width: 100%; padding-top: 133%; overflow: hidden; background: #f4f4f4; }
        .mini-carousel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .mini-carousel img { width: 100%; height: 100%; object-fit: cover; object-position: top center; }
        .stock-label { position: absolute; top: 10px; left: 10px; padding: 4px 10px; font-size: 0.65rem; color: white; font-weight: 700; text-transform: uppercase; border-radius: 4px; z-index: 10; }
        .in-stock { background: rgba(27, 77, 62, 0.9); }
        .out-stock { background: rgba(150, 150, 150, 0.9); }
        .sale-badge { position: absolute; top: 10px; right: 10px; background: #d32f2f; color: white; padding: 4px 8px; font-size: 0.7rem; font-weight: 700; border-radius: 4px; z-index: 10; }
        .original-price { text-decoration: line-through; color: #999; font-size: 0.85rem; margin-right: 5px; }
        .sale-price-text { color: #d32f2f; font-weight: 700; }
        
        .dt-img-container { position: relative; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .dt-main-img { width: 100%; object-fit: cover; aspect-ratio: 3/4; transition: 0.3s; }
        
        /* Popular Badge Overlay */
        .popular-badge-overlay { 
            position: absolute; top: 15px; left: 15px; 
            background: rgba(255, 255, 255, 0.95); 
            padding: 8px 12px; border-radius: 8px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 20; display: flex; align-items: center; gap: 8px;
            animation: fadeInDown 0.5s ease;
        }
        .popular-stars { color: var(--gold); font-size: 0.8rem; }
        .popular-text { font-size: 0.75rem; font-weight: 700; color: var(--primary); text-transform: uppercase; letter-spacing: 0.5px; }
        @keyframes fadeInDown { from {opacity:0; transform:translateY(-10px);} to {opacity:1; transform:translateY(0);} }

        .gallery-container { display: flex; gap: 10px; overflow-x: auto; margin-top: 15px; padding-bottom: 5px; scrollbar-width: none; -ms-overflow-style: none; }
        .gallery-container::-webkit-scrollbar { display: none; }
        .thumb-img { width: 70px; height: 70px; border-radius: 8px; object-fit: cover; cursor: pointer; border: 2px solid transparent; opacity: 0.6; transition: 0.2s; flex-shrink: 0; }
        .thumb-img:hover { opacity: 1; }
        .thumb-img.active { border-color: var(--primary); opacity: 1; transform: scale(1.05); }

        /* Controls */
        .qty-selector { display: inline-flex; align-items: center; border: 1px solid #ddd; border-radius: 50px; overflow: hidden; height: 40px; }
        .qty-btn { background: white; border: none; padding: 0 15px; font-weight: bold; cursor: pointer; color: var(--primary); height: 100%; }
        .qty-btn:hover { background: #f0f0f0; }
        .qty-input { width: 40px; border: none; text-align: center; font-weight: 600; outline: none; background: white; }
        
        .btn-custom { background: var(--primary); color: white; border-radius: 50px; padding: 12px 30px; font-weight: 600; border: none; text-transform: uppercase; transition: 0.3s; }
        .btn-custom:hover { background: var(--primary-dark); color: white; transform: translateY(-2px); shadow: 0 5px 15px rgba(27, 77, 62, 0.3); }
        .btn-custom:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        
        .option-btn { min-width: 40px; height: 40px; padding: 0 15px; border: 1px solid #ddd; background: white; border-radius: 8px; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; margin-right: 8px; margin-bottom: 8px; font-size: 0.9rem; }
        .option-btn:hover { border-color: var(--primary); }
        .option-btn.selected { background: var(--primary); color: white; border-color: var(--primary); }

        /* Modern Description Toggle */
        .desc-container { position: relative; margin-bottom: 20px; }
        .desc-content { color: #666; font-size: 0.95rem; line-height: 1.6; overflow: hidden; transition: max-height 0.4s ease; }
        
        /* Collapsed State */
        .desc-collapsed { max-height: 75px; } /* Shows approx 3 lines */
        .desc-collapsed + .desc-overlay { opacity: 1; pointer-events: none; }
        
        /* Expanded State */
        .desc-expanded { max-height: 1000px; } 
        .desc-expanded + .desc-overlay { opacity: 0; pointer-events: none; }

        /* Fade Overlay */
        .desc-overlay { 
            position: absolute; bottom: 0; left: 0; width: 100%; height: 50px; 
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,1) 90%); 
            transition: opacity 0.3s; 
        }

        .toggle-desc-btn { color: var(--primary); font-weight: 600; font-size: 0.9rem; cursor: pointer; display: inline-block; margin-top: 5px; text-decoration: underline; user-select: none; }
        .toggle-desc-btn:hover { color: var(--gold); }

        /* Utils & Donation */
        .related-scroll { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 15px; -ms-overflow-style: none; scrollbar-width: none; }
        .related-scroll::-webkit-scrollbar { display: none; }
        .related-card { min-width: 140px; width: 140px; border: none; cursor: pointer; }
        .related-card img { border-radius: 8px; width: 100%; aspect-ratio: 3/4; object-fit: cover; margin-bottom: 8px; }
        .marquee-container { width: 100%; overflow: hidden; background: var(--primary); color: var(--gold); padding: 10px 0; border-radius: 8px; margin-bottom: 10px; }
        .marquee-content { display: inline-block; white-space: nowrap; animation: marquee 15s linear infinite; font-weight: 700; letter-spacing: 2px; font-family: 'Playfair Display'; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .donate-pill { flex: 1; border: 1px solid var(--primary); color: var(--primary); background: transparent; padding: 8px; border-radius: 6px; font-weight: 600; font-size: 0.9rem; }
        .donate-pill:hover, .donate-pill.selected { background: var(--primary); color: white; }
        .file-upload-wrapper { position: relative; }
        .upload-helper { font-size: 0.75rem; color: #d32f2f; margin-top: 5px; display: flex; align-items: center; gap: 5px; }

        /* Reviews */
        .rating-stars { display: flex; flex-direction: row-reverse; justify-content: start; gap: 5px; }
        .rating-stars input { display: none; }
        .rating-stars label { cursor: pointer; color: #ddd; font-size: 1.5rem; transition: 0.2s; }
        .rating-stars input:checked ~ label { color: var(--gold); }
        .rating-stars label:hover, .rating-stars label:hover ~ label { color: var(--gold); }
        .review-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); margin-bottom: 15px; }
        .rating-summary-bar { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; flex-grow: 1; margin: 0 10px; }
        .rating-fill { height: 100%; background: var(--gold); }
        .review-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }

        footer { background: #143a2f; color: #888; padding: 60px 0 30px; margin-top: 80px; }
        .footer-heading { color: white; font-family: 'Playfair Display'; margin-bottom: 20px; }
        .footer-link { color: #888; text-decoration: none; display: block; margin-bottom: 10px; font-size: 0.9rem; transition: 0.3s;}
        .footer-link:hover { color: var(--gold); padding-left: 5px; }

        #detail-view { position: fixed; inset: 0; background: #fff; z-index: 2000; overflow-y: auto; display: none; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        #loader { position: fixed; inset: 0; background: white; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
    </style>
</head>
<body>

<script>
    // ********************************************
    // YOUR WEB APP URL:
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzQ3ij0tm5k-cARhUqdRdV7yYmqfudy0LJnaK70DVAMyTcjO-vcc5WvwFQ36lRxobcF/exec"; 
    // ********************************************
</script>

<div id="loader">
    <div class="spinner-border text-secondary" style="width:3rem;height:3rem;"></div>
    <h3 class="mt-3" style="color:var(--primary);font-family:'Playfair Display';">Al-Jazaa</h3>
</div>

<div class="announcement-bar">Shop & Earn Rewards • Secure GCash Payment</div>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
        <a class="navbar-brand" href="#" onclick="routeTo('home')">Al-Jazaa Ph.</a>
        <div class="d-flex align-items-center order-lg-3 ms-auto ms-lg-0">
             <div class="cart-btn-wrap" onclick="routeTo('cart')">
                <i class="fas fa-shopping-bag fa-lg" style="color:#333;"></i>
                <span id="cart-count" class="cart-badge">0</span>
            </div>
            <button class="btn btn-link text-dark p-0 border-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">
                <i class="fas fa-bars fa-lg"></i>
            </button>
        </div>
    </div>
</nav>

<!-- Sidebar -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarMenu">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title">Menu</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
        <a href="#" class="sidebar-link" onclick="routeTo('home'); closeSidebar();">Shop Home <i class="fas fa-chevron-right"></i></a>
        <a href="#" class="sidebar-link" onclick="routeTo('track'); closeSidebar();">Track Order <i class="fas fa-chevron-right"></i></a>
        <a href="#" class="sidebar-link" onclick="routeTo('reviews'); closeSidebar();">Customer Care & Feedback <i class="fas fa-chevron-right"></i></a>
        
        <hr class="my-3 opacity-25">
        <p class="small text-uppercase text-muted fw-bold ms-2 mb-2">Categories</p>
        <div id="sidebar-categories"></div>
        <div class="mt-auto">
            <div class="policy-box">
                <h6>About Al-Jazaa Ph.</h6><p>Al-Jazaa Ph. is committed to providing timeless modesty with Islamic integrity. Our collection is designed to follow the conditions of hijab, with deep consideration for every detail. We carefully select colors and styles to avoid 'Tabarruj', allowing you to wear your faith with dignity and modesty.</p>
                <h6>Payment Policy</h6><p>We strictly accept GCash payments. Verification required via uploading the proof of payment.</p>
                <h6>Delivery Policy</h6><p>Nationwide delivery via J&T courier. Shipping fees vary by region and weight. 3-7 days inside Metro Manila, and 7-10 days outside Metro Manila.</p>
            </div>
        </div>
    </div>
</div>

<!-- HOME -->
<div id="page-home">
    <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="https://github.com/ianianguro-art/Menu-POS/blob/main/Header%201.png?raw=true" class="d-block w-100" alt="Slide 1">
                <div class="carousel-caption"><button class="btn-hero shadow-lg" onclick="scrollToProducts()">Shop Now</button></div>
            </div>
            <div class="carousel-item"><img src="https://github.com/ianianguro-art/Menu-POS/blob/main/Header%202.png?raw=true" class="d-block w-100" alt="Slide 2"></div>
            <div class="carousel-item"><img src="https://github.com/ianianguro-art/Menu-POS/blob/main/Header%203.png?raw=true" class="d-block w-100" alt="Slide 3"></div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
    </div>

    <div class="container my-5" id="shop-section">
        <div class="d-flex justify-content-between align-items-center mb-4"><h2 class="mb-0">Latest Collection</h2></div>
        <div class="position-relative mb-4" style="max-width: 500px;">
            <input type="text" id="searchBox" class="form-control rounded-pill ps-4 py-2 border-secondary" placeholder="Search products..." onkeyup="doSearch()">
            <i class="fas fa-search position-absolute text-muted" style="right: 20px; top: 13px;"></i>
        </div>
        
        <!-- Category Circles -->
        <div id="category-list" class="category-scroll-container mb-4"></div>
        
        <div class="row row-cols-2 row-cols-sm-3 row-cols-lg-4 g-3 g-md-4" id="product-grid"></div>
    </div>
</div>

<!-- DETAIL VIEW -->
<div id="detail-view">
    <div class="container py-5">
        <button class="btn btn-light rounded-circle shadow-sm mb-4" style="width:40px;height:40px;" onclick="window.history.back()">
            <i class="fas fa-arrow-left"></i>
        </button>
        <div class="row gx-5">
            <div class="col-md-5 mb-4">
                <div class="dt-img-container">
                    <!-- Popular/Upsell Badge Container -->
                    <div id="dt-pop-badge" class="popular-badge-overlay d-none">
                        <span class="popular-stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></span>
                        <span class="popular-text" id="pop-text">Best Seller</span>
                    </div>
                    <img id="dt-img" src="" class="dt-main-img">
                </div>
                <div id="dt-gallery" class="gallery-container"></div>
            </div>
            <div class="col-md-7">
                <span class="badge bg-light text-dark mb-2 border" id="dt-cat"></span>
                <h1 id="dt-name" class="display-6 fw-bold"></h1>
                <div class="my-3"><span id="dt-old-price" class="original-price fs-4 d-none"></span><span id="dt-price" class="text-success fw-bold fs-3"></span><span id="dt-sale-badge" class="badge bg-danger ms-2 d-none">SALE</span></div>
                
                <!-- Modern Description Box with Fade & Toggle -->
                <div class="desc-container">
                    <div class="desc-content desc-collapsed" id="dt-desc"></div>
                    <div class="desc-overlay" id="desc-fade"></div>
                    <div class="toggle-desc-btn" id="desc-btn" onclick="toggleDesc()">See more</div>
                </div>

                <!-- Options -->
                <div id="size-row" class="mb-3">
                    <label class="fw-bold mb-2 small text-uppercase">Size <span class="text-danger">*</span></label>
                    <div id="size-area" class="d-flex flex-wrap"></div>
                </div>
                <div class="mb-3"><label class="fw-bold mb-2 small text-uppercase">Color <span class="text-danger">*</span></label><div id="color-area" class="d-flex flex-wrap"></div></div>
                
                <div class="row mb-4">
                    <div class="col-6"><label class="fw-bold mb-2 small text-uppercase">Height <span class="text-danger">*</span></label><input type="text" id="height-input" class="form-control" placeholder="e.g. 5'4" oninput="checkInputs()"></div>
                    <div class="col-6"><label class="fw-bold mb-2 small text-uppercase">Quantity</label><div class="qty-selector w-100 justify-content-between"><button class="qty-btn" onclick="dtQty(-1)">-</button><input type="number" id="dt-qty-val" class="qty-input" value="1" readonly><button class="qty-btn" onclick="dtQty(1)">+</button></div></div>
                </div>
                
                <!-- Button Disabled by Default -->
                <button id="add-btn" class="btn btn-custom w-100 py-3 shadow-lg mb-5" onclick="addToCart()" disabled>ADD TO CART</button>
                
                <hr><h5 class="font-playfair mb-3">You might also like</h5><div id="related-products" class="related-scroll"></div>
            </div>
        </div>
    </div>
</div>

<!-- CART -->
<div id="page-cart" class="container my-5 d-none">
    <h2 class="mb-4 text-center">Your Shopping Bag</h2>
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden"><div class="table-responsive"><table class="table align-middle mb-0"><tbody id="cart-table"></tbody></table></div></div>
            <div class="d-flex justify-content-between align-items-center bg-white p-4 rounded-4 shadow-sm border"><div><small class="text-muted d-block">Total Amount</small><div class="fs-4 fw-bold text-success" id="cart-total">₱0.00</div></div><button id="btn-checkout" class="btn btn-custom px-4" onclick="routeTo('checkout')">CHECKOUT</button></div>
        </div>
    </div>
</div>

<!-- CHECKOUT -->
<div id="page-checkout" class="container my-5 d-none" style="max-width: 800px;">
    <div class="card p-4 p-md-5 shadow-lg border-0 rounded-4">
        <h3 class="text-center mb-2 font-playfair">Checkout</h3>
        <p class="text-center text-muted small mb-4">Complete your details to place order</p>
        <form id="checkout-form" onsubmit="submitOrder(event)" oninput="validateCheckoutForm()">
            <div class="mb-4 bg-light p-3 rounded border">
                <div class="marquee-container shadow-sm mb-3"><div class="marquee-content">✨ DONATE TO ORPHANS • SADQA JARIYAH • HELP THOSE IN NEED • AL-JAZAA PH CHARITY ✨</div></div>
                <p class="small text-muted mb-2 text-center fw-bold">Be among those who care for Orphans. Select Sadaqah amount (Added to Total)</p>
                <div class="d-flex gap-2 flex-wrap justify-content-center mb-3"><button type="button" class="donate-pill" onclick="selectDonation(0.05, this)">5%</button><button type="button" class="donate-pill" onclick="selectDonation(0.10, this)">10%</button><button type="button" class="donate-pill" onclick="selectDonation(0.20, this)">20%</button><button type="button" class="donate-pill" onclick="selectDonation(0.50, this)">50%</button><button type="button" class="donate-pill" onclick="selectDonation(0, this)">None</button></div>
                <textarea id="donation-note" class="form-control d-none" rows="2" placeholder="Special Note / Intention (Optional)"></textarea>
            </div>
            <h6 class="text-uppercase fw-bold text-muted small mb-3">1. Delivery & Address</h6>
            <div class="row g-3 mb-4">
                <div class="col-12"><select class="form-select py-3" id="del-method" onchange="toggleDeliveryOptions()" required><option value="" disabled selected>Select Delivery Method</option><option value="Pick-up">Pick-up (Free)</option><option value="Delivery">Delivery (Courier)</option></select></div>
                <div class="col-md-6"><input type="text" class="form-control" id="c-name" placeholder="Full Name" required></div><div class="col-md-6"><input type="number" class="form-control" id="c-phone" placeholder="Phone Number" required></div><div class="col-12"><input type="email" class="form-control" id="c-email" placeholder="Email Address" required></div>
                <div class="col-12 delivery-fields" style="display:none;"><hr class="opacity-25 my-1"><label class="small fw-bold text-primary mt-2">Shipping Address</label></div>
                <div class="col-md-8 delivery-fields"><input type="text" class="form-control" id="addr-street" placeholder="House / Street / Subdivision"></div><div class="col-md-4 delivery-fields"><input type="text" class="form-control" id="addr-brgy" placeholder="Barangay"></div><div class="col-md-6 delivery-fields"><input type="text" class="form-control" id="addr-city" placeholder="City"></div><div class="col-md-6 delivery-fields"><input type="text" class="form-control" id="addr-prov" placeholder="Province"></div>
                <div class="col-md-8 delivery-fields"><select class="form-select" id="addr-region" onchange="calcShipping()"><option value="" disabled selected>Select Region</option><option value="Metro Manila">Metro Manila</option><option value="Luzon">Luzon</option><option value="Visayas">Visayas</option><option value="Mindanao">Mindanao</option><option value="Island">Island / Remote Areas</option></select></div><div class="col-md-4 delivery-fields"><input type="text" class="form-control" id="addr-zip" placeholder="Zip Code"></div>
            </div>
            <hr class="opacity-25"><h6 class="text-uppercase fw-bold text-muted small mb-3">2. Payment Summary</h6>
            <div class="bg-white p-3 border rounded mb-3"><div class="d-flex justify-content-between mb-1"><span>Subtotal:</span><span id="sum-subtotal">₱0</span></div><div class="d-flex justify-content-between mb-1"><span>Delivery Fee:</span><span id="sum-shipping" class="text-danger">₱0</span></div><div class="d-flex justify-content-between mb-1 d-none" id="sum-donate-row"><span>Donation:</span><span id="sum-donation" class="text-success">₱0</span></div><hr><div class="d-flex justify-content-between fw-bold fs-5"><span>Grand Total:</span><span id="pay-total" class="text-primary">₱0</span></div></div>
            <div class="bg-light p-3 rounded-3 border mb-3 d-flex align-items-center"><div class="bg-white p-2 rounded shadow-sm me-3"><i class="fas fa-qrcode fa-2x"></i></div><div><div class="fw-bold">GCash: 0921-429-5887</div><div class="small text-muted">Scan or Send exact amount.</div></div></div>
            <div class="row g-3"><div class="col-md-6"><input type="text" class="form-control" id="c-ref" placeholder="GCash Reference No." required></div><div class="col-md-6 file-upload-wrapper"><input type="file" class="form-control" id="c-proof" accept="image/*" required><div class="upload-helper"><i class="fas fa-info-circle"></i> Please upload screenshot of payment</div></div></div>
            <div class="mt-4"><button id="btn-place-order" type="submit" class="btn btn-custom w-100 py-3" disabled>FILL DETAILS</button></div>
        </form>
    </div>
</div>

<!-- TRACKING -->
<div id="page-track" class="container my-5 d-none text-center" style="max-width:500px; min-height:50vh;">
    <h3 class="mb-3">Track Order</h3>
    <div class="input-group mb-4 shadow-sm rounded-pill overflow-hidden"><input type="text" id="track-id" class="form-control border-0 ps-4" placeholder="Enter Order ID"><button class="btn btn-custom px-4" onclick="trackOrder()">Search</button></div>
    <div id="track-result" class="card p-4 shadow-sm border-0 rounded-4 d-none text-start bg-white"><div class="fw-bold text-success fs-4 text-center mb-3" id="t-status"></div><hr><div class="d-flex justify-content-between"><span>Date:</span> <span id="t-date"></span></div><div class="d-flex justify-content-between mt-2"><span>Total:</span> <span id="t-total"></span></div></div>
</div>

<!-- REVIEWS -->
<div id="page-reviews" class="container my-5 d-none">
    <div class="row g-5">
        <div class="col-lg-5">
            <div class="card border-0 shadow-lg rounded-4 p-4 sticky-top" style="top: 100px;">
                <h3 class="font-playfair text-center mb-3">Customer Care</h3>
                <p class="text-center text-muted small mb-4">We value your feedback. Let us know how we did!</p>
                <form onsubmit="submitReview(event)">
                    <div class="mb-3"><label class="small fw-bold">Name <span class="text-danger">*</span></label><input type="text" class="form-control" id="r-name" required></div>
                    <div class="mb-3"><label class="small fw-bold">Email <span class="text-danger">*</span></label><input type="email" class="form-control" id="r-email" required></div>
                    <div class="mb-3"><label class="small fw-bold">Mobile Number <span class="text-danger">*</span></label><input type="number" class="form-control" id="r-phone" required></div>
                    <div class="mb-3"><label class="small fw-bold mb-1">Rate Us <span class="text-danger">*</span></label><div class="rating-stars"><input type="radio" name="rating" id="star5" value="5" required><label for="star5"><i class="fas fa-star"></i></label><input type="radio" name="rating" id="star4" value="4"><label for="star4"><i class="fas fa-star"></i></label><input type="radio" name="rating" id="star3" value="3"><label for="star3"><i class="fas fa-star"></i></label><input type="radio" name="rating" id="star2" value="2"><label for="star2"><i class="fas fa-star"></i></label><input type="radio" name="rating" id="star1" value="1"><label for="star1"><i class="fas fa-star"></i></label></div></div>
                    <div class="mb-4"><label class="small fw-bold">Suggestion / Feedback <span class="text-danger">*</span></label><textarea class="form-control" id="r-feedback" rows="4" required></textarea></div>
                    <button type="submit" class="btn btn-custom w-100">Submit Feedback</button>
                </form>
            </div>
        </div>
        <div class="col-lg-7">
            <h3 class="font-playfair mb-4">What our customers say</h3>
            <div class="bg-white p-4 rounded-4 shadow-sm mb-4"><div class="d-flex align-items-center mb-3"><h1 class="mb-0 me-3 fw-bold text-primary" id="avg-rating-display">0.0</h1><div><div class="text-warning" id="avg-stars"></div><small class="text-muted" id="total-reviews">0 Reviews</small></div></div><div id="rating-bars"></div></div>
            <div id="reviews-list"></div>
        </div>
    </div>
</div>

<footer>
    <div class="container">
        <div class="row gy-4">
            <div class="col-md-4"><h3 class="footer-heading">Al-Jazaa Ph.</h3><p class="small text-light">Providing timeless modesty with Islamic integrity.</p></div>
            <div class="col-md-4"><h5 class="text-white mb-3" style="font-family:'Outfit'">Links</h5><a href="#" class="footer-link" onclick="routeTo('home')">Shop Collection</a><a href="#" class="footer-link" onclick="routeTo('track')">Track Order</a><a href="#" class="footer-link" onclick="routeTo('reviews')">Customer Care</a></div>
            <div class="col-md-4"><h5 class="text-white mb-3" style="font-family:'Outfit'">Contact</h5><p class="footer-link mb-1">aljazaa.ph@gmail.com</p><p class="footer-link">0921-429-xxxx</p></div>
        </div>
        <hr class="border-secondary mt-5"><p class="text-center small text-light mb-0">&copy; 2024 Al-Jazaa Ph. All rights reserved.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let allProducts=[], cart=JSON.parse(localStorage.getItem('alj_cart_v14'))||[], curProduct={}, selectedSize=null, selectedColor=null;
    let cartTotalAmount=0, currentDonationPercent=0, currentShippingFee=0;
    
    // --- CATEGORY IMAGES MAPPING ---
    const catImages = {
        'All': 'https://cdn-icons-png.flaticon.com/512/3502/3502601.png', 
        'Jilbab': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat2.png?raw=true',
        'Khimar': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat4.png?raw=true',
        'Abayah': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat3.png?raw=true',
        'Abaya': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat3.png?raw=true', 
        'Set': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat5.png?raw=true',
        'Skirt': 'https://github.com/ianianguro-art/Menu-POS/blob/main/WhatsApp%20Image%202025-11-06%20at%2015.51.23_5f635ea1.jpg?raw=true',
        'Niqab': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat1.png?raw=true',
        'Sale': 'https://github.com/ianianguro-art/Menu-POS/blob/main/big-sale-woolpack-1.jpg?raw=true',
        'Handsock': 'https://cdn-icons-png.flaticon.com/512/863/863684.png',
        'Hat': 'https://cdn-icons-png.flaticon.com/512/2965/2965250.png',
        'Default': 'https://cdn-icons-png.flaticon.com/512/4430/4430945.png'
    };

    const getSidebar = () => bootstrap.Offcanvas.getInstance(document.getElementById('sidebarMenu'));
    const closeSidebar = () => { const s = getSidebar(); if(s) s.hide(); };

    document.addEventListener("DOMContentLoaded", () => {
        fetchProducts(); updateCartCount();
        window.history.replaceState({ page: 'home' }, '', '');
        window.onpopstate = (e) => { if(e.state) renderPage(e.state.page); };
    });

    function routeTo(pageId) { window.history.pushState({ page: pageId }, '', ''); renderPage(pageId); }
    function renderPage(pageId) {
        ['page-home', 'page-cart', 'page-checkout', 'page-track', 'page-reviews'].forEach(id => document.getElementById(id).classList.add('d-none'));
        document.getElementById('detail-view').style.display = 'none'; 
        document.getElementById('heroCarousel').classList.add('d-none'); 
        window.scrollTo(0,0);
        if(pageId === 'home') { document.getElementById('page-home').classList.remove('d-none'); document.getElementById('heroCarousel').classList.remove('d-none'); }
        else { document.getElementById('page-' + pageId).classList.remove('d-none'); }
        if(pageId === 'cart') renderCart();
        if(pageId === 'checkout') { if(cart.length === 0) { Swal.fire({icon:'warning', title:'Empty Bag', text:'Please add items first'}); routeTo('home'); return; } initCheckout(); }
        if(pageId === 'reviews') fetchReviews();
    }

    // --- PRODUCTS & MAIN LOGIC ---
    function fetchProducts() { fetch(WEB_APP_URL + "?action=getProducts").then(r => r.json()).then(data => { allProducts = data; document.getElementById('loader').style.display = 'none'; renderCats(); renderProds(allProducts); }); }
    
    // Render Categories with Circular Images
    function renderCats() { 
        const cats = ['All', ...new Set(allProducts.map(p => p.category))]; 
        document.getElementById('category-list').innerHTML = cats.map(c => {
            let imgUrl = catImages[c] ? catImages[c] : catImages['Default'];
            return `
            <div class="cat-item-wrapper ${c==='All'?'active':''}" onclick="filterCat('${c}', this)">
                <img src="${imgUrl}" class="cat-circle-img" onerror="this.src='${catImages['Default']}'">
                <span class="cat-title">${c}</span>
            </div>`; 
        }).join(''); 
        document.getElementById('sidebar-categories').innerHTML = cats.map(c => `<a href="#" class="sidebar-link" onclick="filterCat('${c}', null, true)">${c} <i class="fas fa-chevron-right"></i></a>`).join(''); 
    }

    function filterCat(c, el, fromSidebar = false) { 
        if(el) { 
            document.querySelectorAll('.cat-item-wrapper').forEach(btn => btn.classList.remove('active')); 
            el.classList.add('active'); 
        } 
        renderProds(c === 'All' ? allProducts : allProducts.filter(p => p.category === c)); 
        if(fromSidebar) { closeSidebar(); routeTo('home'); document.getElementById('shop-section').scrollIntoView({behavior:'smooth'}); } 
    }
    
    function renderProds(list) { document.getElementById('product-grid').innerHTML = list.map(p => { let imgs = (p.images && p.images.length > 0) ? p.images : [p.image]; let itemsHtml = imgs.map((url, idx) => `<div class="carousel-item ${idx===0?'active':''}"><img src="${url.trim()}" class="d-block w-100" loading="lazy"></div>`).join(''); let saleBadge = (p.salePercent > 0) ? `<span class="sale-badge">${p.salePercent}% OFF</span>` : ''; let priceDisplay = (p.salePercent > 0) ? `<span class="original-price">₱${p.originalPrice}</span> <span class="sale-price-text">₱${p.price}</span>` : `<div class="fw-bold text-dark">₱${p.price}</div>`; return `<div class="col"><div class="card product-card"><span class="stock-label ${p.inStock?'in-stock':'out-stock'}">${p.inStock?'In Stock':'Out of Stock'}</span>${saleBadge}<div class="card-img-wrapper" onclick="openDetail('${p.id}')" style="cursor:pointer"><div class="carousel slide mini-carousel" data-bs-interval="false"><div class="carousel-inner">${itemsHtml}</div></div></div><div class="card-body" onclick="openDetail('${p.id}')" style="cursor:pointer"><h6 class="card-title text-dark mb-1 text-truncate">${p.name}</h6>${priceDisplay}</div></div></div>`; }).join(''); }

    // --- DETAIL VIEW ---
    function openDetail(id) {
        window.history.pushState({ page: 'detail' }, '', ''); curProduct = allProducts.find(p => p.id == id); selectedSize = null; selectedColor = null;
        document.getElementById('height-input').value = ""; document.getElementById('dt-qty-val').value = 1;
        
        // Reset Add Button
        const btn = document.getElementById('add-btn'); 
        btn.disabled = true; 
        btn.innerText = curProduct.inStock ? "ADD TO CART" : "OUT OF STOCK";
        if(!curProduct.inStock) btn.disabled = true;

        // Images
        let imgList = (curProduct.images && curProduct.images.length > 0) ? curProduct.images : [curProduct.image];
        document.getElementById('dt-img').src = imgList[0];
        document.getElementById('dt-gallery').innerHTML = imgList.map((src, i) => `<img src="${src}" class="thumb-img ${i===0?'active':''}" onclick="swapImage('${src}', this)">`).join('');

        // Info
        document.getElementById('dt-cat').innerText = curProduct.category; document.getElementById('dt-name').innerText = curProduct.name; 
        
        // Description Toggle Logic
        const descContent = document.getElementById('dt-desc');
        const descBtn = document.getElementById('desc-btn');
        const descFade = document.getElementById('desc-fade');
        
        descContent.innerText = curProduct.desc;
        descContent.classList.remove('desc-expanded');
        descContent.classList.add('desc-collapsed');
        descBtn.innerText = "See more";
        
        if(curProduct.desc.length < 150) { 
            descBtn.style.display='none'; 
            descFade.style.display='none';
            descContent.classList.remove('desc-collapsed'); 
        } else {
            descBtn.style.display='inline-block';
            descFade.style.display='block';
        }

        if(curProduct.salePercent > 0) { document.getElementById('dt-old-price').innerText = "₱" + curProduct.originalPrice; document.getElementById('dt-old-price').classList.remove('d-none'); document.getElementById('dt-sale-badge').innerText = curProduct.salePercent + "% OFF"; document.getElementById('dt-sale-badge').classList.remove('d-none'); document.getElementById('dt-price').innerText = "₱" + curProduct.price; document.getElementById('dt-price').classList.add('text-danger'); } else { document.getElementById('dt-old-price').classList.add('d-none'); document.getElementById('dt-sale-badge').classList.add('d-none'); document.getElementById('dt-price').innerText = "₱" + curProduct.price; document.getElementById('dt-price').classList.remove('text-danger'); }
        
        // NIQAB Logic (Case Insensitive)
        const isNiqab = (curProduct.category.toLowerCase() === 'niqab');
        if(isNiqab) {
            document.getElementById('size-row').style.display = 'none';
            selectedSize = "One Size"; 
        } else {
            document.getElementById('size-row').style.display = 'block';
            document.getElementById('size-area').innerHTML = ["S","M","L","XL"].map(s => `<div class="option-btn size-opt" onclick="pickOption('size','${s}', this)">${s}</div>`).join('');
        }

        // Colors
        let colorList = curProduct.colors ? curProduct.colors.split(',') : ["Default"]; 
        document.getElementById('color-area').innerHTML = colorList.map(c => `<div class="option-btn color-opt" onclick="pickOption('color','${c.trim()}', this)">${c.trim()}</div>`).join('');
        
        // Popular Badge Logic
        const badge = document.getElementById('dt-pop-badge');
        const badgeTexts = ["Best Seller", "Customer Favorite", "Trending Now", "Highly Rated"];
        const showBadge = Math.random() < 0.6;
        if(showBadge && curProduct.inStock) {
            badge.classList.remove('d-none');
            document.getElementById('pop-text').innerText = badgeTexts[Math.floor(Math.random() * badgeTexts.length)];
        } else {
            badge.classList.add('d-none');
        }

        renderRelated(curProduct.category, curProduct.id); document.getElementById('detail-view').style.display = 'block';
        checkInputs();
    }

    function swapImage(src, el) { document.getElementById('dt-img').src = src; document.querySelectorAll('.thumb-img').forEach(img => img.classList.remove('active')); el.classList.add('active'); }
    function renderRelated(cat, currentId) { let related = allProducts.filter(p => p.category === cat && p.id !== currentId).sort(() => 0.5 - Math.random()).slice(0,5); document.getElementById('related-products').innerHTML = related.map(p => `<div class="related-card" onclick="openDetail('${p.id}')"><img src="${p.image}"><div class="small fw-bold text-truncate">${p.name}</div><div class="small text-muted">₱${p.price}</div></div>`).join(''); }
    
    // Toggle Description Function
    function toggleDesc() {
        const content = document.getElementById('dt-desc');
        const btn = document.getElementById('desc-btn');
        
        if (content.classList.contains('desc-collapsed')) {
            content.classList.remove('desc-collapsed');
            content.classList.add('desc-expanded');
            btn.innerText = "See less";
        } else {
            content.classList.remove('desc-expanded');
            content.classList.add('desc-collapsed');
            btn.innerText = "See more";
        }
    }

    function pickOption(type, val, el) { 
        let grp = type === 'size' ? '.size-opt' : '.color-opt'; 
        document.querySelectorAll(grp).forEach(b => b.classList.remove('selected')); 
        el.classList.add('selected'); 
        if(type==='size') selectedSize = val; else selectedColor = val; 
        checkInputs(); 
    }

    function checkInputs() {
        const heightVal = document.getElementById('height-input').value.trim();
        const btn = document.getElementById('add-btn');
        if (curProduct.inStock && selectedSize && selectedColor && heightVal !== "") {
            btn.disabled = false;
        } else {
            btn.disabled = true;
        }
    }

    function dtQty(change) { let el = document.getElementById('dt-qty-val'); let val = parseInt(el.value) + change; if(val < 1) val = 1; el.value = val; }
    
    function addToCart() {
        if(!selectedSize) { Swal.fire({icon: 'error', title: 'Missing Size', text: 'Please select a SIZE.', confirmButtonColor: '#1b4d3e'}); return; }
        if(!selectedColor) { Swal.fire({icon: 'error', title: 'Missing Color', text: 'Please select a COLOR.', confirmButtonColor: '#1b4d3e'}); return; }
        const heightVal = document.getElementById('height-input').value.trim();
        if(!heightVal) { Swal.fire({icon: 'error', title: 'Missing Height', text: 'Please enter your HEIGHT.', confirmButtonColor: '#1b4d3e'}); return; }
        
        let qty = parseInt(document.getElementById('dt-qty-val').value); cart.push({...curProduct, size: selectedSize, color: selectedColor, height: heightVal, qty: qty}); localStorage.setItem('alj_cart_v14', JSON.stringify(cart)); updateCartCount(); Swal.fire({icon: 'success', title: 'Added to Bag', toast:true, position:'top-end', showConfirmButton:false, timer:1500}); window.history.back();
    }
    
    function updateCartCount() { document.getElementById('cart-count').innerText = cart.length; }
    function renderCart() { let total = 0; const tb = document.getElementById('cart-table'); if(cart.length === 0) { tb.innerHTML = '<tr><td class="text-center py-5">Shopping bag is empty</td></tr>'; document.getElementById('btn-checkout').disabled = true; } else { document.getElementById('btn-checkout').disabled = false; tb.innerHTML = cart.map((i,x) => { total += (i.price * i.qty); return `<tr style="border-bottom:1px solid #f0f0f0;"><td class="ps-3" style="width:70px;"><img src="${i.image}" width="60" class="rounded-3 shadow-sm"></td><td><div class="fw-bold">${i.name}</div><div class="small text-muted mb-1">Size: ${i.size} | Color: ${i.color}</div><div class="small text-muted mb-1">Height: ${i.height}</div><div class="text-primary fw-bold">₱${i.price}</div></td><td style="width:120px;"><div class="qty-selector"><button class="qty-btn small" onclick="updateCartQty(${x}, -1)">-</button><input type="text" class="qty-input small" value="${i.qty}" readonly style="width:30px;"><button class="qty-btn small" onclick="updateCartQty(${x}, 1)">+</button></div></td><td class="text-end pe-4"><i class="fas fa-trash-alt text-danger" style="cursor:pointer; opacity:0.6;" onclick="delItem(${x})"></i></td></tr>`; }).join(''); } document.getElementById('cart-total').innerText = "₱" + total.toLocaleString(); }
    function updateCartQty(index, change) { cart[index].qty += change; if(cart[index].qty < 1) { Swal.fire({ title: 'Remove item?', text: "Remove from bag?", icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33' }).then((result) => { if (result.isConfirmed) delItem(index); else { cart[index].qty = 1; renderCart(); } }); } else { localStorage.setItem('alj_cart_v14', JSON.stringify(cart)); renderCart(); } }
    function delItem(i) { cart.splice(i,1); localStorage.setItem('alj_cart_v14', JSON.stringify(cart)); updateCartCount(); renderCart(); }
    
    // --- CHECKOUT ---
    function initCheckout() { cartTotalAmount = cart.reduce((acc, item) => acc + (item.price * item.qty), 0); currentDonationPercent = 0; currentShippingFee = 0; document.getElementById('del-method').value = ""; ['addr-street','addr-brgy','addr-city','addr-prov','addr-region','addr-zip'].forEach(id=>document.getElementById(id).value=""); document.querySelectorAll('.delivery-fields').forEach(el => el.style.display = 'none'); document.querySelectorAll('.donate-pill').forEach(b => b.classList.remove('selected')); updateCheckoutCalculations(); validateCheckoutForm(); }
    function toggleDeliveryOptions() { const m = document.getElementById('del-method').value; const isDel = m === 'Delivery'; document.querySelectorAll('.delivery-fields').forEach(el => el.style.display = isDel ? 'block' : 'none'); document.querySelectorAll('.delivery-fields input, .delivery-fields select').forEach(el => el.required = isDel); calcShipping(); validateCheckoutForm(); }
    function calcShipping() { const method = document.getElementById('del-method').value; const region = document.getElementById('addr-region').value; if (method !== 'Delivery' || !region) { currentShippingFee = 0; } else { const itemCount = cart.reduce((sum, item) => sum + item.qty, 0); let fee = 0; if (region === 'Metro Manila') fee = itemCount===1?90 : itemCount<=3?140 : 250; else if (region === 'Luzon') fee = itemCount===1?100 : itemCount<=3?170 : 320; else if (region === 'Visayas') fee = itemCount===1?140 : itemCount<=3?210 : 370; else if (region === 'Mindanao') fee = itemCount===1?145 : itemCount<=3?220 : 380; else if (region === 'Island') fee = itemCount===1?150 : itemCount<=3?250 : 400; currentShippingFee = fee; } updateCheckoutCalculations(); }
    function selectDonation(p, b) { currentDonationPercent=p; document.querySelectorAll('.donate-pill').forEach(btn=>btn.classList.remove('selected')); b.classList.add('selected'); document.getElementById('donation-note').classList.toggle('d-none', p===0); updateCheckoutCalculations(); }
    function updateCheckoutCalculations() { const d = Math.ceil(cartTotalAmount * currentDonationPercent); const g = cartTotalAmount + currentShippingFee + d; document.getElementById('sum-subtotal').innerText = "₱" + cartTotalAmount.toLocaleString(); document.getElementById('sum-shipping').innerText = "₱" + currentShippingFee; const dr = document.getElementById('sum-donate-row'); if (currentDonationPercent > 0) { dr.classList.remove('d-none'); document.getElementById('sum-donation').innerText = "₱" + d; } else dr.classList.add('d-none'); document.getElementById('pay-total').innerText = "₱" + g.toLocaleString(); }
    function validateCheckoutForm() { const f=document.getElementById('checkout-form'); const b=document.getElementById('btn-place-order'); if(f.checkValidity()) { b.disabled=false; b.innerText="PLACE ORDER"; } else { b.disabled=true; b.innerText="FILL DETAILS"; } }
    function submitOrder(e) {
        e.preventDefault(); const f = document.getElementById('c-proof').files[0]; if(!f) return;
        Swal.fire({ title: 'Processing...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
        const r = new FileReader(); r.onload = function(evt) {
            const d = Math.ceil(cartTotalAmount * currentDonationPercent); const g = cartTotalAmount + currentShippingFee + d;
            let addr = "Pick-up"; if(document.getElementById('del-method').value === 'Delivery'){ addr = `${document.getElementById('addr-street').value}, ${document.getElementById('addr-brgy').value}, ${document.getElementById('addr-city').value}, ${document.getElementById('addr-prov').value}, ${document.getElementById('addr-region').value}, ${document.getElementById('addr-zip').value}`; }
            const p = { action: 'placeOrder', cust: { name:document.getElementById('c-name').value, phone:document.getElementById('c-phone').value, email:document.getElementById('c-email').value, addr:addr }, pay: { ref:document.getElementById('c-ref').value, image:evt.target.result, mime:f.type }, cart: cart, total: "₱" + g.toLocaleString(), donation: { percent: (currentDonationPercent * 100) + "%", amount: d, note: document.getElementById('donation-note').value }, delivery: { method: document.getElementById('del-method').value, region: document.getElementById('addr-region').value || "N/A", fee: currentShippingFee } };
            fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify(p) }).then(res => res.json()).then(d => { if(d.status === 'success') { cart = []; localStorage.setItem('alj_cart_v14', JSON.stringify(cart)); Swal.fire({icon: 'success', title: 'Order Placed!', html: `Tracking ID: <b>${d.orderId}</b>`, confirmButtonColor: '#1b4d3e'}).then(() => routeTo('home')); } else Swal.fire('Error', d.error, 'error'); });
        }; r.readAsDataURL(f);
    }
    function doSearch() { const q = document.getElementById('searchBox').value.toLowerCase(); renderProds(allProducts.filter(p => p.name.toLowerCase().includes(q))); }
    function scrollToProducts() { document.getElementById('shop-section').scrollIntoView({behavior:'smooth'}); }
    function trackOrder() {
        const id = document.getElementById('track-id').value.trim(); if(!id) return; document.getElementById('loader').style.display = 'flex';
        fetch(WEB_APP_URL + `?action=trackOrder&orderId=${id}`).then(r => r.json()).then(d => { document.getElementById('loader').style.display = 'none'; document.getElementById('track-result').classList.remove('d-none'); document.getElementById('t-status').innerText = d.status === 'found' ? d.currStatus : "Order Not Found"; document.getElementById('t-date').innerText = d.status === 'found' ? d.date : "-"; document.getElementById('t-total').innerText = d.status === 'found' ? d.total : "-"; });
    }

    // --- REVIEWS LOGIC ---
    function fetchReviews() {
        document.getElementById('loader').style.display = 'flex';
        fetch(WEB_APP_URL + "?action=getReviews").then(r=>r.json()).then(data => {
            document.getElementById('loader').style.display = 'none';
            renderReviewList(data);
        });
    }

    function renderReviewList(reviews) {
        document.getElementById('total-reviews').innerText = reviews.length + " Reviews";
        let total = 0, counts = {5:0, 4:0, 3:0, 2:0, 1:0};
        reviews.forEach(r => { let rt = parseInt(r.rating); total += rt; if(counts[rt] !== undefined) counts[rt]++; });
        let avg = reviews.length ? (total / reviews.length).toFixed(1) : "0.0";
        document.getElementById('avg-rating-display').innerText = avg;
        document.getElementById('avg-stars').innerHTML = getStarsHtml(Math.round(avg));
        document.getElementById('rating-bars').innerHTML = [5,4,3,2,1].map(num => { let pct = reviews.length ? (counts[num] / reviews.length * 100) : 0; return `<div class="d-flex align-items-center mb-2"><span class="small fw-bold me-2" style="width:10px;">${num}</span><i class="fas fa-star text-warning small me-2"></i><div class="rating-summary-bar"><div class="rating-fill" style="width:${pct}%"></div></div><span class="small text-muted" style="width:30px;text-align:right;">${counts[num]}</span></div>`; }).join('');
        document.getElementById('reviews-list').innerHTML = reviews.map(r => `<div class="review-card"><div class="review-header"><div><div class="fw-bold">${r.name}</div><div class="text-warning small">${getStarsHtml(r.rating)}</div></div><small class="text-muted">${r.date}</small></div><p class="text-secondary small mb-0">${r.feedback}</p></div>`).join('');
    }

    function getStarsHtml(rating) { let h = ''; for(let i=0; i<5; i++) h += `<i class="${i < rating ? 'fas' : 'far'} fa-star"></i>`; return h; }

    function submitReview(e) {
        e.preventDefault();
        const rName = document.getElementById('r-name').value; const rEmail = document.getElementById('r-email').value; const rPhone = document.getElementById('r-phone').value; const rFeedback = document.getElementById('r-feedback').value;
        let rRating = 0; document.querySelectorAll('input[name="rating"]').forEach(r => { if(r.checked) rRating = r.value; });
        if(rRating === 0) { Swal.fire('Error','Please select a star rating','warning'); return; }
        Swal.fire({ title: 'Submitting...', didOpen: () => Swal.showLoading() });
        const p = { action: 'submitReview', name: rName, email: rEmail, phone: rPhone, feedback: rFeedback, rating: rRating };
        fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify(p) }).then(r=>r.json()).then(d => { if(d.status === 'success') { Swal.fire('Thank You!', 'Your feedback has been submitted.', 'success'); document.getElementById('r-name').value = ""; document.getElementById('r-email').value = ""; document.getElementById('r-phone').value = ""; document.getElementById('r-feedback').value = ""; document.querySelectorAll('input[name="rating"]').forEach(r => r.checked = false); fetchReviews(); } else { Swal.fire('Error', d.error, 'error'); } });
    }
</script>
</body>
</html>
