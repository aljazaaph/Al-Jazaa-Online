<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Al-Jazaa Ph | Modern Modesty</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://github.com/ianianguro-art/Website-Gallery-Image/blob/main/Jaz%20Logo%20gold.png?raw=true">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root {
            --primary: #1b4d3e; 
            --primary-dark: #143a2f;
            --gold: #c5a028;
            --bg-color: #f9fafb; 
            --text: #374151;
            --nav-height: 60px;
        }

        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text); 
            padding-top: 35px; 
            font-size: 14px; /* Base font size reduced */
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, h5, .font-playfair { font-family: 'Playfair Display', serif; }

        /* --- 1. Top Flashing Bar --- */
        .announcement-bar { 
            background: var(--primary); color: white; height: 35px;
            position: fixed; top: 0; left: 0; width: 100%; z-index: 2000;
            display: flex; align-items: center; justify-content: center;
        }
        .flash-text {
            font-size: 0.7rem; font-weight: 600; letter-spacing: 1px; text-transform: uppercase;
            animation: flash 3s infinite;
        }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; color: var(--gold); } }

        /* --- 2. Navbar --- */
        .navbar { 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(8px);
            height: var(--nav-height); top: 35px; z-index: 1030;
            box-shadow: 0 1px 5px rgba(0,0,0,0.05);
        }
        .navbar-brand { font-size: 1.2rem; font-weight: 700; color: var(--primary) !important; display: flex; align-items: center; gap: 8px; }
        .nav-logo-img { height: 30px; width: auto; }
        .cart-icon-wrap { position: relative; cursor: pointer; color: #333; margin-right: 15px; }
        .cart-badge { 
            background: var(--gold); color: white; border-radius: 50%; 
            width: 16px; height: 16px; font-size: 0.6rem; 
            display: flex; align-items: center; justify-content: center; 
            position: absolute; top: -5px; right: -8px; 
        }

        /* --- Sidebar (75% Width) --- */
        .offcanvas { width: 75% !important; max-width: 300px; border-radius: 0 16px 16px 0; }
        .sidebar-link { padding: 12px 20px; border-bottom: 1px solid #f0f0f0; display: block; color: #444; text-decoration: none; font-weight: 500; }
        .sidebar-link:hover { background: #f9f9f9; color: var(--primary); }

        /* --- 3. Home Elements --- */
        .search-container { background: white; padding: 10px 15px; margin-bottom: 10px; }
        .search-input { border-radius: 50px; background: #f3f4f6; border: none; padding: 8px 15px; width: 100%; font-size: 0.9rem; }
        .search-input:focus { outline: none; box-shadow: 0 0 0 1px var(--primary); background: white; }

        /* Hero Button */
        .btn-shop-now {
            background: rgba(255,255,255,0.9); color: var(--primary);
            padding: 8px 20px; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;
            border: none; border-radius: 4px; font-weight: 700; transition: 0.3s;
        }
        .btn-shop-now:hover { transform: scale(1.05); background: white; }

        /* Product Card (Responsive) */
        .product-card { 
            background: white; border-radius: 8px; border: none; overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: 0.2s;
        }
        .product-card:hover { transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .card-img-wrap { position: relative; padding-top: 133%; background: #f0f0f0; } /* 3:4 Aspect Ratio */
        .card-img-wrap img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .card-body { padding: 10px; }
        .prod-cat { font-size: 0.65rem; text-transform: uppercase; color: #999; letter-spacing: 0.5px; }
        .prod-title { font-size: 0.85rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 2px; }
        .prod-price { font-size: 0.9rem; font-weight: 700; color: var(--primary); }
        .sale-tag { position: absolute; top: 8px; right: 8px; background: #e74c3c; color: white; font-size: 0.6rem; padding: 2px 6px; border-radius: 3px; font-weight: bold; }

        /* --- 4. Category Page (New) --- */
        .cat-grid { 
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; 
        }
        @media(min-width: 768px) { .cat-grid { grid-template-columns: repeat(4, 1fr); } }
        
        .cat-tile {
            position: relative; border-radius: 12px; overflow: hidden; aspect-ratio: 1/1;
            cursor: pointer;
        }
        .cat-tile img { width: 100%; height: 100%; object-fit: cover; transition: 0.4s; }
        .cat-tile-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.3);
            display: flex; align-items: center; justify-content: center;
        }
        .cat-tile-text { 
            color: white; font-family: 'Playfair Display'; font-size: 1.2rem; 
            font-weight: 600; letter-spacing: 1px; border-bottom: 2px solid var(--gold);
        }
        .cat-tile:hover img { transform: scale(1.1); }

        /* --- 5. Detail View --- */
        #detail-view { 
            position: fixed; inset: 0; background: white; z-index: 2050; 
            overflow-y: auto; display: none; padding-bottom: 80px;
        }
        .detail-header {
            position: sticky; top: 0; background: rgba(255,255,255,0.98); border-bottom: 1px solid #eee;
            padding: 0 15px; height: 50px; display: flex; align-items: center; justify-content: space-between; z-index: 2060;
        }
        
        /* Side Scroll Images */
        .image-scroller {
            display: flex; overflow-x: auto; scroll-snap-type: x mandatory; 
            -webkit-overflow-scrolling: touch; scrollbar-width: none;
        }
        .image-scroller::-webkit-scrollbar { display: none; }
        .image-slide { 
            flex: 0 0 100%; width: 100%; aspect-ratio: 3/4; 
            scroll-snap-align: center; background: #f8f8f8;
        }
        .image-slide img { width: 100%; height: 100%; object-fit: contain; }

        /* Bundle Cards */
        .bundle-row { 
            border: 1px solid #eee; padding: 10px; border-radius: 8px; margin-bottom: 8px; 
            display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s;
        }
        .bundle-row.active { border-color: var(--primary); background: #f0fdf9; }
        .badge-save { font-size: 0.65rem; background: var(--gold); color: white; padding: 2px 5px; border-radius: 3px; margin-left: 5px; }

        /* Sticky Action Bar */
        .sticky-action-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; background: white;
            padding: 10px 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 2070;
            display: flex; align-items: center; justify-content: space-between;
        }
        .btn-add-cart { 
            background: var(--primary); color: white; border: none; 
            border-radius: 50px; padding: 10px 25px; font-weight: 600; font-size: 0.85rem; 
        }

        /* --- 6. Cart & Checkout --- */
        .progress-meter { height: 6px; background: #eee; border-radius: 10px; overflow: hidden; margin-top: 5px; }
        .progress-val { height: 100%; background: var(--primary); width: 0%; transition: 1s; }
        
        .checkout-summary-toggle {
            background: #f8f9fa; padding: 12px; border-radius: 8px; cursor: pointer;
            font-weight: 600; font-size: 0.9rem; display: flex; justify-content: space-between;
        }

        /* --- Reviews --- */
        .review-box { background: #fafafa; padding: 15px; margin-top: 20px; border-top: 1px solid #eee; }
        .star-select i { color: #ddd; font-size: 1.2rem; cursor: pointer; }
        .star-select i.checked { color: var(--gold); }

        /* --- Footer --- */
        footer { background: #222; color: #888; padding: 40px 0 20px; font-size: 0.85rem; }
        .footer-link { color: #888; text-decoration: none; display: block; margin-bottom: 8px; }
        .footer-link:hover { color: white; }

        /* Back to Top */
        .btt-btn {
            position: fixed; bottom: 90px; right: 20px; width: 40px; height: 40px;
            background: white; color: var(--primary); border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 0.3s; z-index: 1040;
        }
        .btt-btn.show { opacity: 1; pointer-events: all; }
        
        /* Utils */
        .d-none { display: none !important; }
    </style>
</head>
<body>

<script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzQ3ij0tm5k-cARhUqdRdV7yYmqfudy0LJnaK70DVAMyTcjO-vcc5WvwFQ36lRxobcF/exec"; 
</script>

<!-- Loader -->
<div id="loader" style="position:fixed; inset:0; background:white; z-index:9999; display:flex; justify-content:center; align-items:center;">
    <div class="spinner-border text-success" style="width:2rem;height:2rem;"></div>
</div>

<!-- Flashing Announcement (Home Only) -->
<div class="announcement-bar" id="flash-bar">
    <div class="flash-text">✨ Free Delivery @ ₱3,000 ✨ 5% Profit to Charity ✨</div>
</div>

<!-- Navbar -->
<nav class="navbar navbar-expand fixed-top">
    <div class="container-fluid px-3">
        <a class="navbar-brand" href="#" onclick="routeTo('home')">
            <img src="https://github.com/ianianguro-art/Website-Gallery-Image/blob/main/Jaz%20Logo%20gold.png?raw=true" class="nav-logo-img">
            Al-Jazaa Ph.
        </a>
        <div class="d-flex align-items-center">
             <div class="cart-icon-wrap" onclick="routeTo('cart')">
                <i class="fas fa-shopping-bag fa-lg"></i>
                <span id="cart-count" class="cart-badge">0</span>
            </div>
            <button class="btn border-0 p-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">
                <i class="fas fa-bars fa-lg text-dark"></i>
            </button>
        </div>
    </div>
</nav>

<!-- Sidebar -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarMenu">
    <div class="offcanvas-header bg-light">
        <h5 class="offcanvas-title font-playfair fw-bold text-success">Menu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body p-0">
        <a href="#" class="sidebar-link" onclick="routeTo('home'); closeSidebar();"><i class="fas fa-home me-2"></i> Home</a>
        <a href="#" class="sidebar-link" onclick="routeTo('categories'); closeSidebar();"><i class="fas fa-th-large me-2"></i> Categories</a>
        <a href="#" class="sidebar-link" onclick="routeTo('track'); closeSidebar();"><i class="fas fa-truck me-2"></i> Track Order</a>
        <a href="#" class="sidebar-link" onclick="routeTo('cart'); closeSidebar();"><i class="fas fa-shopping-bag me-2"></i> View Cart</a>
    </div>
</div>

<!-- === 1. HOME PAGE === -->
<div id="page-home">
    <!-- Search -->
    <div class="search-container">
        <div class="position-relative">
            <i class="fas fa-search position-absolute text-muted" style="left:12px; top:10px; font-size:0.9rem;"></i>
            <input type="text" id="searchBox" class="search-input ps-5" placeholder="Search products..." onkeyup="doSearch()">
        </div>
    </div>

    <!-- Carousel -->
    <div id="heroCarousel" class="carousel slide mb-3" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="https://github.com/ianianguro-art/Menu-POS/blob/main/Header%201.png?raw=true" class="d-block w-100" alt="1">
                <div class="carousel-caption p-0 mb-4">
                    <button class="btn-shop-now shadow" onclick="routeTo('categories')">SHOP NOW</button>
                </div>
            </div>
            <div class="carousel-item"><img src="https://github.com/ianianguro-art/Menu-POS/blob/main/Header%202.png?raw=true" class="d-block w-100" alt="2"></div>
        </div>
    </div>

    <div class="container-fluid px-2 mb-4">
        <div class="d-flex justify-content-between align-items-center mb-2 px-1">
            <h5 class="font-playfair mb-0 fw-bold">Latest Arrivals</h5>
            <small class="text-success fw-bold" onclick="routeTo('categories')" style="cursor:pointer;">View All</small>
        </div>
        <!-- Product Grid -->
        <div class="row row-cols-2 row-cols-md-4 row-cols-lg-5 g-2" id="home-product-grid"></div>
    </div>
</div>

<!-- === 2. CATEGORY PAGE (Requested) === -->
<div id="page-categories" class="d-none">
    <div class="container-fluid px-2 py-3">
        <h4 class="font-playfair text-center mb-3">Shop by Category</h4>
        <!-- Category Grid -->
        <div class="cat-grid" id="cat-page-grid">
            <!-- Populated via JS -->
        </div>

        <hr class="my-4 opacity-25">
        
        <h5 class="font-playfair mb-3 px-1">Popular Items</h5>
        <div class="row row-cols-2 row-cols-md-4 g-2" id="cat-popular-grid"></div>
    </div>
</div>

<!-- === 3. DETAIL VIEW === -->
<div id="detail-view">
    <div class="detail-header">
        <div class="d-flex align-items-center">
            <button class="btn p-0 me-3" onclick="closeDetail()"><i class="fas fa-arrow-left"></i></button>
            <span class="font-playfair fw-bold text-success text-truncate" style="max-width:150px;" id="dt-head-title">...</span>
        </div>
        <div class="position-relative" onclick="routeTo('cart'); closeDetail();">
            <i class="fas fa-shopping-bag"></i>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark" style="font-size:0.5rem;" id="dt-cart-bubble">0</span>
        </div>
    </div>

    <!-- Images -->
    <div class="image-scroller" id="dt-images"></div>
    <div class="text-center small text-muted my-2"><i class="fas fa-circle" style="font-size:5px;"></i> Swipe Image</div>

    <div class="container-fluid px-3 pb-4">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <span class="text-uppercase text-muted" style="font-size:0.7rem;" id="dt-cat"></span>
                <h4 class="font-playfair fw-bold mb-1" id="dt-name"></h4>
            </div>
        </div>
        
        <div class="mb-3">
            <span class="fs-4 fw-bold text-success" id="dt-price"></span>
            <span class="text-decoration-line-through text-muted ms-2 small" id="dt-old"></span>
        </div>

        <!-- Description -->
        <div class="text-muted small mb-4" id="dt-desc" style="line-height:1.5;"></div>

        <!-- Controls -->
        <div id="controls-section">
            <div class="mb-3">
                <label class="small fw-bold mb-1">SIZE</label>
                <div id="dt-sizes" class="d-flex flex-wrap gap-2"></div>
            </div>
            <div class="mb-3">
                <label class="small fw-bold mb-1">COLOR</label>
                <div id="dt-colors" class="d-flex flex-wrap gap-2"></div>
            </div>
            <div class="mb-3">
                <label class="small fw-bold mb-1">HEIGHT (ft)</label>
                <input type="text" id="dt-height" class="form-control form-control-sm" placeholder="e.g. 5'4">
            </div>
        </div>

        <!-- Bundles -->
        <div id="bundle-container" class="mb-4">
            <label class="small fw-bold mb-2 text-primary">BUNDLE OFFERS</label>
            <div class="bundle-row active" onclick="setBundle(1, this)">
                <span class="small fw-bold">1 Piece</span>
                <span class="small text-muted">Regular Price</span>
            </div>
            <div class="bundle-row" onclick="setBundle(2, this)">
                <span class="small fw-bold">2 Pieces <span class="badge-save">5% OFF</span></span>
                <span class="small fw-bold text-success" id="bp-2"></span>
            </div>
            <div class="bundle-row" onclick="setBundle(3, this)">
                <span class="small fw-bold">3 Pieces <span class="badge-save">10% OFF</span></span>
                <span class="small fw-bold text-success" id="bp-3"></span>
            </div>
        </div>

        <!-- Reviews & Form -->
        <div class="review-box rounded">
            <h6 class="font-playfair fw-bold mb-3">Reviews</h6>
            <div id="dt-review-list"></div>
            <hr>
            <form onsubmit="postReview(event)">
                <label class="small fw-bold">Write a Review</label>
                <div class="star-select mb-2" id="star-input">
                    <i class="fas fa-star" data-v="1" onclick="rate(1)"></i>
                    <i class="fas fa-star" data-v="2" onclick="rate(2)"></i>
                    <i class="fas fa-star" data-v="3" onclick="rate(3)"></i>
                    <i class="fas fa-star" data-v="4" onclick="rate(4)"></i>
                    <i class="fas fa-star" data-v="5" onclick="rate(5)"></i>
                </div>
                <input type="hidden" id="r-rating" value="5">
                <input type="text" class="form-control form-control-sm mb-2" id="r-name" placeholder="Name" required>
                <textarea class="form-control form-control-sm mb-2" id="r-msg" rows="2" placeholder="Feedback" required></textarea>
                <input type="file" class="form-control form-control-sm mb-2">
                <button class="btn btn-dark btn-sm w-100">Submit</button>
            </form>
        </div>
    </div>

    <!-- Sticky Bottom Bar -->
    <div class="sticky-action-bar">
        <div>
            <div class="small text-muted" style="font-size:0.7rem;">Total Price</div>
            <div class="fw-bold text-success fs-5" id="sticky-total">₱0</div>
        </div>
        <div class="d-flex align-items-center gap-2">
            <div class="bg-light rounded-pill px-2 d-flex align-items-center border" style="height:38px;">
                <button class="btn btn-sm px-1 fw-bold" onclick="dtQty(-1)">-</button>
                <span class="mx-2 small fw-bold" id="qty-disp">1</span>
                <button class="btn btn-sm px-1 fw-bold" onclick="dtQty(1)">+</button>
            </div>
            <button class="btn-add-cart shadow" onclick="addToCart()">ADD TO CART</button>
        </div>
    </div>
</div>

<!-- === 4. CART PAGE === -->
<div id="page-cart" class="d-none container my-4">
    <h4 class="font-playfair text-center mb-3">Shopping Bag</h4>
    
    <!-- Progress -->
    <div class="card p-3 border-0 shadow-sm mb-3">
        <div class="d-flex justify-content-between small fw-bold">
            <span>Current</span>
            <span class="text-success">Free Ship @ ₱3,000</span>
        </div>
        <div class="progress-meter">
            <div class="progress-val" id="ship-bar"></div>
        </div>
        <p class="text-center small text-muted mt-1 mb-0" id="ship-txt">Add more items...</p>
    </div>

    <div id="cart-list"></div>

    <div class="mt-4">
        <h6 class="font-playfair mb-2">People also buy this</h6>
        <div class="d-flex gap-2 overflow-auto pb-2" id="cart-suggest"></div>
    </div>

    <div class="fixed-bottom bg-white p-3 shadow-lg border-top d-md-none">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="text-muted small">Total</span>
            <span class="fw-bold fs-5 text-success" id="mob-cart-total">₱0</span>
        </div>
        <button class="btn btn-dark w-100 rounded-pill" onclick="routeTo('checkout')">CHECKOUT</button>
    </div>
    
    <div class="d-none d-md-block text-end mt-4">
        <h4 class="fw-bold text-success" id="desk-cart-total">Total: ₱0</h4>
        <button class="btn btn-dark px-5 rounded-pill" onclick="routeTo('checkout')">CHECKOUT</button>
    </div>
</div>

<!-- === 5. CHECKOUT === -->
<div id="page-checkout" class="d-none container my-4" style="max-width:600px;">
    <h4 class="font-playfair text-center mb-3">Checkout</h4>
    <form onsubmit="placeOrder(event)">
        
        <!-- Summary Toggle -->
        <div class="checkout-summary-toggle mb-3" data-bs-toggle="collapse" data-bs-target="#summBox">
            <span><i class="fas fa-shopping-cart me-2"></i> Order Summary</span>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="collapse show mb-4" id="summBox">
            <div class="bg-light p-3 rounded" id="co-list"></div>
            <div class="d-flex justify-content-between fw-bold mt-2 px-2">
                <span>Total Payment:</span>
                <span class="text-primary" id="co-total">₱0</span>
            </div>
        </div>

        <div class="card p-3 border-0 shadow-sm mb-3">
            <h6 class="fw-bold mb-3">Delivery</h6>
            <select class="form-select form-select-sm mb-2" id="del-type" onchange="toggleAddr()" required>
                <option value="" disabled selected>Method</option>
                <option value="Pick-up">Pick-up (Free)</option>
                <option value="Delivery">Courier</option>
            </select>
            <input type="text" class="form-control form-control-sm mb-2" id="co-name" placeholder="Name" required>
            <input type="tel" class="form-control form-control-sm mb-2" id="co-phone" placeholder="Phone" required>
            
            <div class="del-fields d-none">
                <input type="text" class="form-control form-control-sm mb-2" id="co-addr" placeholder="Address">
                <select class="form-select form-select-sm" id="co-region" onchange="calcShip()">
                    <option value="">Region</option>
                    <option value="MM">Metro Manila</option>
                    <option value="Luzon">Luzon</option>
                    <option value="VisMin">Vis/Min</option>
                </select>
            </div>
        </div>

        <div class="card p-3 border-0 shadow-sm mb-3">
            <h6 class="fw-bold mb-3">Payment (GCash)</h6>
            <div class="alert alert-secondary py-2 text-center small">Send to <strong>0976-551-3716</strong></div>
            <input type="text" class="form-control form-control-sm mb-2" id="co-ref" placeholder="Ref No." required>
            <input type="file" class="form-control form-control-sm" id="co-img" required>
        </div>

        <button class="btn btn-dark w-100 rounded-pill py-2">PLACE ORDER</button>
    </form>
</div>

<!-- === 6. TRACKING === -->
<div id="page-track" class="d-none container my-5 text-center">
    <h4 class="font-playfair mb-3">Track Order</h4>
    <div class="input-group mb-3 shadow-sm rounded-pill overflow-hidden" style="max-width:400px; margin:0 auto;">
        <input type="text" id="track-input" class="form-control border-0 ps-4" placeholder="Order ID">
        <button class="btn btn-dark px-4" onclick="doTrack()">Search</button>
    </div>
    <div id="track-res"></div>
</div>

<!-- FOOTER -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-6">
                <h5 class="text-white font-playfair mb-2">Al-Jazaa</h5>
                <p class="small opacity-75">Modesty with Integrity.</p>
            </div>
            <div class="col-6 text-end">
                <a href="#" class="footer-link" onclick="routeTo('home')">Home</a>
                <a href="#" class="footer-link" onclick="routeTo('categories')">Categories</a>
                <a href="#" class="footer-link" onclick="routeTo('track')">Track</a>
            </div>
        </div>
        <hr class="border-secondary">
        <div class="text-center opacity-50 small">&copy; 2024 Al-Jazaa Ph.</div>
    </div>
</footer>

<div class="btt-btn" onclick="window.scrollTo({top:0, behavior:'smooth'})"><i class="fas fa-arrow-up"></i></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let products=[], cart=JSON.parse(localStorage.getItem('alj_cart_v16'))||[], currentItem={}, bundleQty=1;
    
    // Config
    const catImages = {
        'Niqab': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat1.png?raw=true',
        'Jilbab': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat2.png?raw=true',
        'Abaya': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat3.png?raw=true',
        'Khimar': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat4.png?raw=true',
        'Sets': 'https://github.com/ianianguro-art/Menu-POS/blob/main/cat5.png?raw=true',
        'Other': 'https://cdn-icons-png.flaticon.com/512/3502/3502601.png'
    };

    window.onload = () => {
        fetch(WEB_APP_URL + "?action=getProducts").then(r=>r.json()).then(d => {
            products = d;
            document.getElementById('loader').style.display='none';
            renderHome();
            renderCategories();
        });
        updateBadge();
        
        window.onscroll = () => {
            document.querySelector('.btt-btn').classList.toggle('show', window.scrollY > 300);
        };
    };

    function routeTo(page) {
        document.querySelectorAll('[id^="page-"]').forEach(p => p.classList.add('d-none'));
        document.getElementById('detail-view').style.display = 'none';
        document.getElementById('page-'+page).classList.remove('d-none');
        document.body.style.overflow = 'auto';
        window.scrollTo(0,0);
        
        document.getElementById('flash-bar').style.display = (page === 'home') ? 'flex' : 'none';
        
        if(page==='cart') renderCart();
        if(page==='checkout') initCheckout();
    }
    
    const closeSidebar = () => bootstrap.Offcanvas.getInstance(document.getElementById('sidebarMenu')).hide();
    const closeDetail = () => { document.getElementById('detail-view').style.display='none'; document.body.style.overflow='auto'; };

    // --- RENDER FUNCTIONS ---
    function renderHome() {
        // Just the latest 8 products
        const latest = products.slice(0, 8);
        document.getElementById('home-product-grid').innerHTML = latest.map(makeCard).join('');
    }

    function renderCategories() {
        const cats = [...new Set(products.map(p=>p.category))];
        document.getElementById('cat-page-grid').innerHTML = cats.map(c => `
            <div class="cat-tile shadow-sm" onclick="filterCatPage('${c}')">
                <img src="${catImages[c] || catImages['Other']}">
                <div class="cat-tile-overlay">
                    <span class="cat-tile-text">${c}</span>
                </div>
            </div>
        `).join('');

        const pop = products.sort(()=>0.5-Math.random()).slice(0,6);
        document.getElementById('cat-popular-grid').innerHTML = pop.map(makeCard).join('');
    }

    function filterCatPage(c) {
        document.getElementById('cat-page-grid').innerHTML = `
            <div class="col-12 text-center mb-3">
                <button class="btn btn-outline-dark btn-sm" onclick="renderCategories()"><i class="fas fa-arrow-left"></i> Back to Categories</button>
                <h4 class="mt-2 font-playfair">${c}</h4>
            </div>
        ` + products.filter(p=>p.category===c).map(p=>`<div class="cat-tile shadow-none" style="aspect-ratio:auto;">${makeCard(p)}</div>`).join(''); 
        // Re-using grid class styling slightly hacked for simplicity, usually would swap container
        document.getElementById('cat-page-grid').style.display = 'flex';
        document.getElementById('cat-page-grid').style.flexWrap = 'wrap';
        document.getElementById('cat-page-grid').style.gap = '10px';
        document.getElementById('cat-page-grid').innerHTML = products.filter(p=>p.category===c).map(p=>`<div style="width:48%;">${makeCard(p)}</div>`).join('');
    }

    function makeCard(p) {
        return `
            <div class="col">
                <div class="product-card h-100" onclick="openDetail('${p.id}')">
                    <div class="card-img-wrap"><img src="${p.image}"></div>
                    ${p.salePercent ? `<span class="sale-tag">${p.salePercent}% OFF</span>` : ''}
                    <div class="card-body">
                        <div class="prod-cat">${p.category}</div>
                        <div class="prod-title">${p.name}</div>
                        <div class="prod-price">₱${p.price}</div>
                    </div>
                </div>
            </div>
        `;
    }

    // --- DETAIL LOGIC ---
    function openDetail(id) {
        currentItem = products.find(p=>p.id==id);
        bundleQty = 1;
        document.getElementById('detail-view').style.display='block';
        document.body.style.overflow='hidden';

        document.getElementById('dt-head-title').innerText = currentItem.name;
        document.getElementById('dt-name').innerText = currentItem.name;
        document.getElementById('dt-cat').innerText = currentItem.category;
        document.getElementById('dt-price').innerText = "₱" + currentItem.price;
        document.getElementById('dt-desc').innerText = currentItem.desc;
        document.getElementById('qty-disp').innerText = 1;
        document.getElementById('dt-cart-bubble').innerText = cart.length;

        // Images
        const imgs = currentItem.images && currentItem.images.length ? currentItem.images : [currentItem.image];
        document.getElementById('dt-images').innerHTML = imgs.map(src=>`<div class="image-slide"><img src="${src}"></div>`).join('');

        // Options
        const isNiqab = currentItem.category === 'Niqab';
        const renderBtns = (arr, id) => document.getElementById(id).innerHTML = arr.map(v=>`<button class="btn btn-outline-dark btn-sm" onclick="selOpt(this)">${v}</button>`).join('');
        
        if(isNiqab) {
            document.getElementById('controls-section').classList.add('d-none');
            document.getElementById('bundle-container').classList.add('d-none');
        } else {
            document.getElementById('controls-section').classList.remove('d-none');
            document.getElementById('bundle-container').classList.remove('d-none');
            renderBtns(['S','M','L','XL'], 'dt-sizes');
            renderBtns(currentItem.colors?currentItem.colors.split(','):['Default'], 'dt-colors');
            
            // Bundle Prices
            let p = currentItem.price;
            document.getElementById('bp-2').innerText = "₱" + Math.floor((p*2)*0.95);
            document.getElementById('bp-3').innerText = "₱" + Math.floor((p*3)*0.90);
            setBundle(1, document.querySelector('.bundle-row')); // Reset
        }

        // Reviews
        document.getElementById('dt-review-list').innerHTML = `<div class="small text-muted fst-italic">No reviews yet.</div>`;

        updateSticky();
    }

    function selOpt(btn) {
        Array.from(btn.parentNode.children).forEach(b=>b.classList.remove('btn-dark','text-white'));
        btn.classList.add('btn-dark','text-white');
    }

    function setBundle(q, el) {
        bundleQty = q;
        document.querySelectorAll('.bundle-row').forEach(b=>b.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('qty-disp').innerText = q;
        updateSticky();
    }

    function dtQty(c) {
        let q = parseInt(document.getElementById('qty-disp').innerText) + c;
        if(q<1) q=1;
        document.getElementById('qty-disp').innerText = q;
        // If bundles active, visual sync only for now
        if(currentItem.category !== 'Niqab') {
             if(q===2) setBundle(2, document.querySelectorAll('.bundle-row')[1]);
             else if(q===3) setBundle(3, document.querySelectorAll('.bundle-row')[2]);
             else setBundle(1, document.querySelectorAll('.bundle-row')[0]);
        }
        bundleQty = q;
        updateSticky();
    }

    function updateSticky() {
        let p = currentItem.price * bundleQty;
        if(currentItem.category!=='Niqab') {
            if(bundleQty===2) p *= 0.95;
            if(bundleQty===3) p *= 0.90;
        }
        document.getElementById('sticky-total').innerText = "₱" + Math.floor(p);
    }

    function addToCart() {
        // Validation skipped for brevity
        let sBtn = document.querySelector('#dt-sizes .btn-dark');
        let cBtn = document.querySelector('#dt-colors .btn-dark');
        let h = document.getElementById('dt-height').value;
        
        let size = sBtn ? sBtn.innerText : 'OneSize';
        let color = cBtn ? cBtn.innerText : 'Default';
        
        let unitP = currentItem.price;
        if(currentItem.category!=='Niqab') {
            if(bundleQty===2) unitP *= 0.95;
            if(bundleQty===3) unitP *= 0.90;
        }

        cart.push({...currentItem, price:Math.floor(unitP), qty:bundleQty, size, color, height:h});
        localStorage.setItem('alj_cart_v16', JSON.stringify(cart));
        updateBadge();
        Swal.fire({icon:'success', title:'Added', toast:true, position:'top-end', showConfirmButton:false, timer:1000});
        closeDetail();
    }

    function updateBadge() { document.getElementById('cart-count').innerText = cart.length; }

    // --- CART ---
    function renderCart() {
        const d = document.getElementById('cart-list');
        if(!cart.length) { d.innerHTML='<div class="text-center py-5 text-muted">Empty</div>'; updateCartTotal(0); return;}
        
        let t = 0;
        d.innerHTML = cart.map((i,x) => {
            t += i.price * i.qty;
            return `
            <div class="d-flex align-items-center mb-3 bg-white p-2 rounded shadow-sm">
                <img src="${i.image}" style="width:60px; height:60px; object-fit:cover; border-radius:4px;">
                <div class="ms-3 flex-grow-1">
                    <div class="small fw-bold text-truncate">${i.name}</div>
                    <div class="small text-muted" style="font-size:0.7rem;">${i.size}, ${i.color}</div>
                    <div class="small fw-bold text-success">₱${i.price} x ${i.qty}</div>
                </div>
                <i class="fas fa-trash text-danger ms-2" onclick="remItem(${x})"></i>
            </div>`;
        }).join('');
        updateCartTotal(t);

        const sug = products.slice(0,4);
        document.getElementById('cart-suggest').innerHTML = sug.map(p=>`<div style="min-width:100px;" onclick="openDetail('${p.id}')"><img src="${p.image}" class="rounded w-100"><div class="small fw-bold text-truncate">${p.name}</div></div>`).join('');
    }

    function updateCartTotal(t) {
        document.getElementById('mob-cart-total').innerText = "₱"+t;
        document.getElementById('desk-cart-total').innerText = "Total: ₱"+t;
        let p = (t/3000)*100; if(p>100)p=100;
        document.getElementById('ship-bar').style.width = p+"%";
        document.getElementById('ship-txt').innerText = p===100?"Free Delivery!":`Add ₱${3000-t} more`;
    }
    
    function remItem(i) { cart.splice(i,1); localStorage.setItem('alj_cart_v16', JSON.stringify(cart)); renderCart(); updateBadge(); }

    // --- CHECKOUT ---
    function initCheckout() {
        const l = document.getElementById('co-list');
        let t = 0;
        l.innerHTML = cart.map(i => { t+=i.price*i.qty; return `<div class="d-flex justify-content-between small"><span>${i.qty}x ${i.name}</span><span>₱${i.price*i.qty}</span></div>`; }).join('');
        document.getElementById('co-total').dataset.val = t;
        calcShip();
    }

    function toggleAddr() {
        const isDel = document.getElementById('del-type').value === 'Delivery';
        document.querySelector('.del-fields').classList.toggle('d-none', !isDel);
        calcShip();
    }

    function calcShip() {
        let t = parseInt(document.getElementById('co-total').dataset.val);
        let s = 0;
        if(document.getElementById('del-type').value === 'Delivery' && t < 3000) {
            let r = document.getElementById('co-region').value;
            if(r==='MM') s=100; else if(r==='Luzon') s=150; else if(r==='VisMin') s=200;
        }
        document.getElementById('co-total').innerText = "₱" + (t+s);
    }

    function placeOrder(e) {
        e.preventDefault();
        Swal.fire({title:'Processing...', didOpen:()=>Swal.showLoading()});
        setTimeout(()=>{
            cart=[]; localStorage.setItem('alj_cart_v16','[]'); updateBadge();
            Swal.fire('Ordered!','Tracking: #12345','success').then(()=>routeTo('home'));
        },2000);
    }

    function doSearch() {
        const q = document.getElementById('searchBox').value.toLowerCase();
        const f = products.filter(p=>p.name.toLowerCase().includes(q));
        document.getElementById('home-product-grid').innerHTML = f.map(makeCard).join('');
    }

    function rate(n) {
        document.querySelectorAll('.star-select i').forEach(e => e.classList.toggle('checked', e.dataset.v <= n));
    }
    function postReview(e) { e.preventDefault(); Swal.fire('Thanks!','Review submitted','success'); }
</script>
</body>
</html>
